<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Quantitative Text Analysis for Linguistics - 5&nbsp; Acquire data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./curate-datasets.html" rel="next">
<link href="./preparation.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><link rel="stylesheet" href="assets/style.css">
</head>
<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Acquire data</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Quantitative Text Analysis for Linguistics</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com" title="" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Welcome</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./orientation.html" class="sidebar-item-text sidebar-link">Orientation</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./text-analysis.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Text analysis in context</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./foundations.html" class="sidebar-item-text sidebar-link">Foundations</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./understanding-data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Understanding data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./approaching-analysis.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Approaching analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./framing-research.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Framing research</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./preparation.html" class="sidebar-item-text sidebar-link">Preparation</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./acquire-data.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Acquire data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./curate-datasets.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Curate data(sets)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./transform-datasets.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Transform datasets</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./analysis.html" class="sidebar-item-text sidebar-link">Analysis</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exploration.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Exploration</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prediction.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Prediction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./inference.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Inference</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./communication.html" class="sidebar-item-text sidebar-link">Communication</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reporting.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Reporting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./collaboration.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Collaboration</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">Appendices</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Data</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#downloads" id="toc-downloads" class="nav-link active" data-scroll-target="#downloads"><span class="toc-section-number">5.1</span>  Downloads</a>
  <ul class="collapse">
<li><a href="#manual" id="toc-manual" class="nav-link" data-scroll-target="#manual"><span class="toc-section-number">5.1.1</span>  Manual</a></li>
  <li><a href="#programmatic" id="toc-programmatic" class="nav-link" data-scroll-target="#programmatic"><span class="toc-section-number">5.1.2</span>  Programmatic</a></li>
  </ul>
</li>
  <li>
<a href="#apis" id="toc-apis" class="nav-link" data-scroll-target="#apis"><span class="toc-section-number">5.2</span>  APIs</a>
  <ul class="collapse">
<li><a href="#open-access" id="toc-open-access" class="nav-link" data-scroll-target="#open-access"><span class="toc-section-number">5.2.1</span>  Open access</a></li>
  <li><a href="#authentication" id="toc-authentication" class="nav-link" data-scroll-target="#authentication"><span class="toc-section-number">5.2.2</span>  Authentication</a></li>
  </ul>
</li>
  <li>
<a href="#web-scraping" id="toc-web-scraping" class="nav-link" data-scroll-target="#web-scraping"><span class="toc-section-number">5.3</span>  Web scraping</a>
  <ul class="collapse">
<li><a href="#a-toy-example" id="toc-a-toy-example" class="nav-link" data-scroll-target="#a-toy-example"><span class="toc-section-number">5.3.1</span>  A toy example</a></li>
  <li><a href="#a-practical-example" id="toc-a-practical-example" class="nav-link" data-scroll-target="#a-practical-example"><span class="toc-section-number">5.3.2</span>  A practical example</a></li>
  <li><a href="#scaling-up" id="toc-scaling-up" class="nav-link" data-scroll-target="#scaling-up"><span class="toc-section-number">5.3.3</span>  Scaling up</a></li>
  </ul>
</li>
  <li><a href="#documentation" id="toc-documentation" class="nav-link" data-scroll-target="#documentation"><span class="toc-section-number">5.4</span>  Documentation</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#activities" id="toc-activities" class="nav-link" data-scroll-target="#activities">Activities</a></li>
  <li><a href="#questions" id="toc-questions" class="nav-link" data-scroll-target="#questions">Questions</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-acquire-data" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Acquire data</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><!--

Content:

- [ ] Project Gutenberg (work on fixing or changing the data that is accessed)
- [ ] Figure out what do do with Twitter API: can we still stream? Or is `rtoot` for Mastodon a better option at this point?
- [ ] Figure out what to do with the web scraping section: Gutenberg Project (single page), SPLLOC (multiple pages), Maybe the American Presidency Project?

Exercises:

- [ ] Add concept questions to the Activities
- [ ] Add exercises to the Activities
- [ ] Add thought questions/ case studies to prose sections

Formatting:


--><blockquote class="blockquote">
<p>The scariest moment is always just before you start.</p>
<p>―– Stephen King</p>
</blockquote>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Keys
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>What are the most common strategies for acquiring corpus data?</li>
<li>What programmatic steps can we take to ensure the acquisition process is reproducible?</li>
<li>What is the importance of documenting data?</li>
</ul>
</div>
</div>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/acquire-data-packages_718a21361e03c4201c806e047f780e06">

</div>
<p>There are three main ways to acquire corpus data using R that I will introduce you to: <strong>downloads</strong>, <strong>APIs</strong>, and <strong>web scraping</strong>. In this chapter we will start by manual and programmatically downloading a corpus as it is the most straightforward process for the novice R programmer and typically incurs the least number of steps. Along the way I will introduce some key R coding concepts including control statements and custom functions. Next I will cover using R packages to interface with APIs, both open-access and authentication-based. APIs will require us to delve into more detail about R objects and custom functions. Finally acquiring data from the web via webscraping is the most idiosyncratic and involves both knowledge of the web, more sophisticated R skills, and often some clever hacking skills. I will start with a crash course on the structure of web documents (HTML) and then scale up to a real-world example. To round out the chapter we will cover the process of ensuring that our data is documented in such a way as to provide sufficient information to understand its key sampling characteristics and the source from which it was drawn.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Swirl
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>What</strong>: <a href="https://github.com/lin380/swirl">Loops and vectorization</a><br><strong>How</strong>: In the R Console pane load <code>swirl</code>, run <code>swirl()</code>, and follow prompts to select the lesson.<br><strong>Why</strong>: To ….</p>
</div>
</div>
<section id="downloads" class="level2" data-number="5.1"><h2 data-number="5.1" class="anchored" data-anchor-id="downloads">
<span class="header-section-number">5.1</span> Downloads</h2>
<section id="manual" class="level3" data-number="5.1.1"><h3 data-number="5.1.1" class="anchored" data-anchor-id="manual">
<span class="header-section-number">5.1.1</span> Manual</h3>
<p>The first acquisition method I will cover here is inherently non-reproducible from the standpoint that the programming implementation cannot acquire the data based solely on running the project code itself. In other words, it requires manual intervention. Manual downloads are typical for data resources which are not openly accessible on the public facing web. These can be resources that require institutional or private licensing (<a href="https://www.ldc.upenn.edu/">Language Data Consortium</a>, <a href="http://ice-corpora.net/ice/">International Corpus of English</a>, <a href="https://www.corpusdata.org/">BYU Corpora</a>, etc.), require authorization/ registration (<a href="https://archive.mpi.nl/tla/">The Language Archive</a>, <a href="https://www.webcorpora.org/">COW Corpora</a>, etc.), and/ or are only accessible via resource search interfaces (<a href="https://cesa.arizona.edu/">Corpus of Spanish in Southern Arizona</a>, <a href="http://cedel2.learnercorpora.com/">Corpus Escrito del Español como L2 (CEDEL2)</a>, etc.).</p>
<p>Let’s work with the CEDEL2 corpus <span class="citation" data-cites="Lozano2009">(<a href="references.html#ref-Lozano2009" role="doc-biblioref">Lozano 2009</a>)</span> which provides a search interface and open access to the data through the search interface. The homepage can be seen in <a href="#fig-ad-show-page-cedel2-1">Figure&nbsp;<span>5.1</span></a>.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/fig-ad-show-page-cedel2-1_10efc64e767d4eb9a6c1cfe37fd94b51">
<div class="cell-output-display">
<div id="fig-ad-show-page-cedel2-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figures/acquire-data/ad-cedel2-site.png" class="img-fluid figure-img" width="1392"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5.1: CEDEL2 Corpus homepage</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Following the search/ download link you can find a search interface that allows the user to select the sub-corpus of interest. I’ve selected the subcorpus “Learners of L2 Spanish” and specified the L1 as English.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/fig-ad-show-page-cedel2-2_0689e4a8a927ee09f938a30cf2d30806">
<div class="cell-output-display">
<div id="fig-ad-show-page-cedel2-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figures/acquire-data/ad-cedel2-search-download.png" class="img-fluid figure-img" width="1392"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5.2: Search and download interface for the CEDEL2 Corpus</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The ‘Download’ link now appears for this search criteria. Following this link will provide the user a form to fill out. This particular resource allows for access to different formats to download (Texts only, Texts with metadata, CSV (Excel), CSV (Others)). I will select the ‘CSV (Others)’ option so that the data is structured for easier processing downstream when we work to curate the data in our next processing step. Then I will choose to save the CSV in the <code>data/original/</code> directory of my project and create a sub-directory called <code>cedel2/</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data/</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> cedel2</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>       <span class="ex">└──</span> texts.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Other resources will inevitably include unique processes to obtaining the data, but in the end the data should be archived in the research structure in the <code>data/original/</code> directory and be treated as ‘read-only’.</p>
</section><section id="programmatic" class="level3" data-number="5.1.2"><h3 data-number="5.1.2" class="anchored" data-anchor-id="programmatic">
<span class="header-section-number">5.1.2</span> Programmatic</h3>
<p>There are many resources that provide corpus data is directly accessible for which programmatic approaches can be applied. Let’s take a look at how this works starting with the a sample from the Switchboard Corpus, a corpus of 2,400 telephone conversations by 543 speakers. First we navigate to the site with a browser and download the file that we are looking for. In this case I found the Switchboard Corpus on the <a href="http://www.nltk.org/nltk_data/">NLTK data repository site</a>. More often than not this file will be some type of compressed archive file with an extension such as <code>.zip</code> or <code>.tz</code>, which is the case here. Archive files make downloading large single files or multiple files easy by grouping files and directories into one file. In R we can used the <code><a href="https://rdrr.io/r/utils/download.file.html">download.file()</a></code> function from the base R library<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. There are a number of <strong>arguments</strong> that a function may require or provide optionally. The <code><a href="https://rdrr.io/r/utils/download.file.html">download.file()</a></code> function minimally requires two: <code>url</code> and <code>destfile</code>. That is the file to download and the location where it is to be saved to disk.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-sbc-download-file_2bbed1558923e763475e89ee397a916e">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Download .zip file and write to disk</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/nltk/nltk_data/gh-pages/packages/corpora/switchboard.zip"</span>, destfile <span class="op">=</span> <span class="st">"../data/original/switchboard.zip"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As we can see looking at the directory structure for <code>data/</code> the <code>switchboard.zip</code> file has been downloaded.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> switchboard.zip</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Once an archive file is downloaded, however, the file needs to be ‘decompressed’ to reveal the file structure. To decompress this file we use the <code><a href="https://rdrr.io/r/utils/unzip.html">unzip()</a></code> function with the arguments <code>zipfile</code> pointing to the <code>.zip</code> file and <code>exdir</code> specifying the directory where we want the files to be extracted to.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-sbc-decompress-file_2ab031fba766e177ac938b7581a61a97">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Decompress .zip file and extract to our target directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span><span class="op">(</span>zipfile <span class="op">=</span> <span class="st">"../data/original/switchboard.zip"</span>, exdir <span class="op">=</span> <span class="st">"../data/original/"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The directory structure of <code>data/</code> now should look like this:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> switchboard</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── README</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── discourse</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── disfluency</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── tagged</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── timed-transcript</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   └── transcript</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> switchboard.zip</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>At this point we have acquired the data programmatically and with this code as part of our workflow anyone could run this code and reproduce the same results. The code as it is, however, is not ideally efficient. Firstly the <code>switchboard.zip</code> file is not strictly needed after we decompress it and it occupies disk space if we keep it. And second, each time we run this code the file will be downloaded from the remote serve leading to unnecessary data transfer and server traffic. Let’s tackle each of these issues in turn.</p>
<p>To avoid writing the <code>switchboard.zip</code> file to disk (long-term) we can use the <code><a href="https://rdrr.io/r/base/tempfile.html">tempfile()</a></code> function to open a temporary holding space for the file. This space can then be used to store the file, unzip it, and then the temporary file will be destroyed. We assign the temporary space to an R object we will name <code>temp</code> with the <code><a href="https://rdrr.io/r/base/tempfile.html">tempfile()</a></code> function. This object can now be used as the value of the argument <code>destfile</code> in the <code><a href="https://rdrr.io/r/utils/download.file.html">download.file()</a></code> function. Let’s also assign the web address to another object <code>url</code> which we will use as the value of the <code>url</code> argument.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-sbc-temp-file_cc05dc7e6d488a4a5202acf4139d62fe">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create a temporary file space for our .zip file</span></span>
<span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Assign our web address to `url`</span></span>
<span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/nltk/nltk_data/gh-pages/packages/corpora/switchboard.zip"</span></span>
<span><span class="co"># Download .zip file and write to disk</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span><span class="va">url</span>, <span class="va">temp</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the previous code I’ve used the values stored in the objects <code>url</code> and <code>temp</code> in the <code><a href="https://rdrr.io/r/utils/download.file.html">download.file()</a></code> function without specifying the argument names –only providing the names of the objects. R will assume that values of a function map to the ordering of the arguments. If your values do not map to ordering of the arguments you are required to specify the argument name and the value. To view the ordering of objects hit <code>TAB</code> after entering the function name or consult the function documentation by prefixing the function name with <code>?</code> and hitting <code>ENTER</code>.</p>
</div>
</div>
<p>At this point our downloaded file is stored temporarily on disk and can be accessed and decompressed to our target directory using <code>temp</code> as the value for the argument <code>zipfile</code> from the <code><a href="https://rdrr.io/r/utils/unzip.html">unzip()</a></code> function. I’ve assigned our target directory path to <code>target_dir</code> and used it as the value for the argument <code>exdir</code> to prepare us for the next tweak on our approach.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-sbc-unzip-temp_893b7759a4049aea6c474c84f8866179">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Assign our target directory to `target_dir`</span></span>
<span><span class="va">target_dir</span> <span class="op">&lt;-</span> <span class="st">"../data/original/"</span></span>
<span><span class="co"># Decompress .zip file and extract to our target directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span><span class="op">(</span>zipfile <span class="op">=</span> <span class="va">temp</span>, exdir <span class="op">=</span> <span class="va">target_dir</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our directory structure now looks like this:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> switchboard</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> README</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> discourse</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> disfluency</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> tagged</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> timed-transcript</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> transcript</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The second issue I raised concerns the fact that running this code as part of our project will repeat the download each time. Since we would like to be good citizens and avoid unnecessary traffic on the web it would be nice if our code checked to see if we already have the data on disk and if it exists, then skip the download, if not then download it.</p>
<p>To achieve this we need to introduce two new functions <code>if()</code> and <code><a href="https://rdrr.io/r/base/files2.html">dir.exists()</a></code>. <code><a href="https://rdrr.io/r/base/files2.html">dir.exists()</a></code> takes a path to a directory as an argument and returns the logical value, <code>TRUE</code>, if that directory exists, and <code>FALSE</code> if it does not. <code>if()</code> evaluates logical statements and processes subsequent code based on the logical value it is passed as an argument. Let’s look at a toy example.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-if-logical-true_424a4e3f489f542d8d1f821b1575bca7">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">num</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="va">num</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">num</span>, <span class="st">"is 1"</span><span class="op">)</span> </span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">num</span>, <span class="st">"is not 1"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 1 is 1</code></pre>
</div>
</div>
<p>I assigned <code>num</code> to the value <code>1</code> and created a logical evaluation <code>num ==</code> whose result is passed as the argument to <code>if()</code>. If the statement returns <code>TRUE</code> then the code withing the first set of curly braces <code>{...}</code> is run. If <code>num == 1</code> is false, like in the code below, the code withing the braces following the <code>else</code> will be run.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-if-logical-false_800b3ce709e37040e8231550aa184df8">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">num</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="va">num</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">num</span>, <span class="st">"is 1"</span><span class="op">)</span> </span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">num</span>, <span class="st">"is not 1"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 2 is not 1</code></pre>
</div>
</div>
<p>The function <code>if()</code> is one of various functions that are called <strong>control statements</strong>. Theses functions provide a lot of power to make dynamic choices as code is run.</p>
<p>Before we get back to our key objective to avoid downloading resources that we already have on disk, let me introduce another strategy to making code more powerful and ultimately more efficient and as well as more legible –the <strong>custom function</strong>. Custom functions are functions that the user writes to create a set of procedures that can be run in similar contexts. I’ve created a custom function named <code>eval_num()</code> below.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-custom-function-eval-num_c929b59814fb42153c02fcaaa8af421b">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">eval_num</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">num</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">num</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">num</span>, <span class="st">"is 1"</span><span class="op">)</span> </span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">num</span>, <span class="st">"is not 1"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s take a closer look at what’s going on here. The function <code>function()</code> creates a function in which the user decides what arguments are necessary for the code to perform its task. In this case the only necessary argument is the object to store a numeric value to be evaluated. I’ve called it <code>num</code> because it reflects the name of the object in our toy example, but there is nothing special about this name. It’s only important that the object names be consistently used. I’ve included our previous code (except for the hard-coded assignment of <code>num</code>) inside the curly braces and assigned the entire code chunk to <code>eval_num</code>.</p>
<p>We can now use the function <code>eval_num()</code> to perform the task of evaluating whether a value of <code>num</code> is or is not equal to <code>1</code>.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-eval-num_48d46fcb4fb389a5da45f058003af03c">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">eval_num</span><span class="op">(</span>num <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 1 is 1</code></pre>
</div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">eval_num</span><span class="op">(</span>num <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 2 is not 1</code></pre>
</div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">eval_num</span><span class="op">(</span>num <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 3 is not 1</code></pre>
</div>
</div>
<p>I’ve put these coding strategies together with our previous code in a custom function I named <code>get_zip_data()</code>. There is a lot going on here. Take a look first and see if you can follow the logic involved given what you now know.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-get-zip-data-function_1cbb72e98bc292b64c2e8bc6178abda1">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">get_zip_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">url</span>, <span class="va">target_dir</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Function: to download and decompress a .zip file to a target directory</span></span>
<span>  </span>
<span>  <span class="co"># Check to see if the data already exists</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span><span class="op">(</span><span class="va">target_dir</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="co"># if data does not exist, download/ decompress</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Creating target data directory \n"</span><span class="op">)</span> <span class="co"># print status message</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">target_dir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># create target data directory</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Downloading data... \n"</span><span class="op">)</span> <span class="co"># print status message</span></span>
<span>    <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># create a temporary space for the file to be written to</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">url</span>, destfile <span class="op">=</span> <span class="va">temp</span><span class="op">)</span> <span class="co"># download the data to the temp file</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span><span class="op">(</span>zipfile <span class="op">=</span> <span class="va">temp</span>, exdir <span class="op">=</span> <span class="va">target_dir</span>, junkpaths <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># decompress the temp file in the target directory</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Data downloaded! \n"</span><span class="op">)</span> <span class="co"># print status message</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> <span class="co"># if data exists, don't download it again</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Data already exists \n"</span><span class="op">)</span> <span class="co"># print status message</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>OK. You should have recognized the general steps in this function: the argument <code>url</code> and <code>target_dir</code> specify where to get the data and where to write the decompressed files, the <code>if()</code> statement evaluates whether the data already exists, if not (<code>!dir.exists(target_dir)</code>) then the data is downloaded and decompressed, if it does exist (<code>else</code>) then it is not downloaded.</p>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The prefixed <code>!</code> in the logical expression <code>dir.exists(target_dir)</code> returns the opposite logical value. This is needed in this case so when the target directory exists, the expression will return <code>FALSE</code>, not <code>TRUE</code>, and therefore not proceed in downloading the resource.</p>
</div>
</div>
<p>There are a couple key tweaks I’ve added that provide some additional functionality. For one I’ve included the function <code><a href="https://rdrr.io/r/base/files2.html">dir.create()</a></code> to create the target directory where the data will be written. I’ve also added an additional argument to the <code><a href="https://rdrr.io/r/utils/unzip.html">unzip()</a></code> function, <code>junkpaths = TRUE</code>. Together these additions allow the user to create an arbitrary directory path where the files, and only the files, will be extracted to on our disk. This will discard the containing directory of the <code>.zip</code> file which can be helpful when we want to add multiple <code>.zip</code> files to the same target directory.</p>
<p>A practical scenario where this applies is when we want to download data from a corpus that is contained in multiple <code>.zip</code> files but still maintain these files in a single primary data directory. Take for example the <a href="http://www.linguistics.ucsb.edu/research/santa-barbara-corpus">Santa Barbara Corpus</a>. This corpus resource includes a series of interviews in which there is one <code>.zip</code> file, <code>SBCorpus.zip</code> which contains the <a href="http://www.linguistics.ucsb.edu/sites/secure.lsit.ucsb.edu.ling.d7/files/sitefiles/research/SBC/SBCorpus.zip">transcribed interviews</a> and another <code>.zip</code> file, <code>metadata.zip</code> which organizes the <a href="http://www.linguistics.ucsb.edu/sites/secure.lsit.ucsb.edu.ling.d7/files/sitefiles/research/SBC/metadata.zip">meta-data</a> associated with each speaker. Applying our initial strategy to download and decompress the data will lead to the following directory structure:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> SBCorpus</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── TRN</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> └── __MACOSX</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span>     └── TRN</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> metadata</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> __MACOSX</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By applying our new custom function <code>get_zip_data()</code> to the transcriptions and then the meta-data we can better organize the data.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-get-zip-data-sbc_9bccef56e1509c8eb188bb078f07181a">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Download corpus transcriptions</span></span>
<span><span class="fu">get_zip_data</span><span class="op">(</span>url <span class="op">=</span> <span class="st">"http://www.linguistics.ucsb.edu/sites/secure.lsit.ucsb.edu.ling.d7/files/sitefiles/research/SBC/SBCorpus.zip"</span>, target_dir <span class="op">=</span> <span class="st">"../data/original/sbc/transcriptions/"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Download corpus meta-data</span></span>
<span><span class="fu">get_zip_data</span><span class="op">(</span>url <span class="op">=</span> <span class="st">"http://www.linguistics.ucsb.edu/sites/secure.lsit.ucsb.edu.ling.d7/files/sitefiles/research/SBC/metadata.zip"</span>, target_dir <span class="op">=</span> <span class="st">"../data/original/sbc/meta-data/"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> sbc</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> meta-data</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> transcriptions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If we add data from other sources we can keep them logical separate and allow our data collection to scale without creating unnecessary complexity. Let’s add the Switchboard Corpus sample using our <code>get_zip_data()</code> function to see this in action.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-get-zip-data-scs_027c00c8185a6cfda7bd64c53e8deffc">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Download corpus</span></span>
<span><span class="fu">get_zip_data</span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/nltk/nltk_data/gh-pages/packages/corpora/switchboard.zip"</span>, target_dir <span class="op">=</span> <span class="st">"../data/original/scs/"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> sbc</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── meta-data</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   └── transcriptions</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> scs</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> README</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> discourse</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> disfluency</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> tagged</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> timed-transcript</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> transcript</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>At this point we have what we need to continue to the next step in our data analysis project. But before we go, we should do some housekeeping to document and organize this process to make our work reproducible. We will take advantage of the <code>project-template</code> directory structure, seen below.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> README.md</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> _pipeline.R</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> analysis</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── 1_acquire_data.Rmd</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── 2_curate_dataset.Rmd</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── 3_transform_dataset.Rmd</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── 4_analyze_dataset.Rmd</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── 5_generate_article.Rmd</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── _session-info.Rmd</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── _site.yml</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── index.Rmd</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── references.bib</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> data</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── derived</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── original</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>       ├── sbc</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>       └── scs</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> functions</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> output</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> figures</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>First it is good practice to separate custom functions from our processing scripts. We can create a file in our <code>functions/</code> directory named <code>acquire_functions.R</code> and add our custom function <code>get_zip_data()</code> there.</p>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that that the <code>acquire_functions.R</code> file is an R script, not an Rmarkdown document. Therefore code chunks that are used in <code>.Rmd</code> files are not used, only the R code itself.</p>
</div>
</div>
<p>We then use the <code><a href="https://rdrr.io/r/base/source.html">source()</a></code> function to read that function into our current script to make it available to use as needed. It is good practice to source your functions in the SETUP section of your script.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-source-function_bf2349f9b51acab9c5f13d45b8cb1231">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load custom functions for this project</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"../functions/acquire_functions.R"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this section, to sum up, we’ve covered how to access, download, and organize data contained in .zip files; the most common format for language data found on repositories and individual sites. This included an introduction to a few key R programming concepts and strategies including using functions, writing custom functions, and controlling program flow with control statements. Our approach was to gather data while also keeping in mind the reproducibility of the code. To this end I introduced programming strategies for avoiding unnecessary web traffic (downloads), scalable directory creation, and data documentation.</p>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The custom function <code>get_zip_data()</code> works with <code>.zip</code> files. There are many other compressed file formats (e.g.&nbsp;<code>.gz</code>, <code>.tar</code>, <code>.tgz</code>), however. In the R package <code>tadr</code> that accompanies this coursebook, a modified version of the <code>get_zip_data()</code> function, <code>get_compressed_data()</code>, extends the same logic to deal with a wider range of compressed file formats, including <code>.zip</code> files.</p>
<p>Explore this function’s documentation (<code>?tadr::get_compressed_data()</code>) and/ or view the code (<code><a href="https://rdrr.io/pkg/tadr/man/get_compressed_data.html">tadr::get_compressed_data</a></code>) to better understand this function.</p>
</div>
</div>
</section></section><section id="apis" class="level2" data-number="5.2"><h2 data-number="5.2" class="anchored" data-anchor-id="apis">
<span class="header-section-number">5.2</span> APIs</h2>
<p>A convenient alternative method for acquiring data in R is through package interfaces to web services. These interfaces are built using R code to make connections with resources on the web through <strong>Application Programming Interfaces</strong> (APIs). Websites such as Project Gutenberg, Twitter, Facebook, and many others provide APIs to allow access to their data under certain conditions, some more limiting for data collection than others. Programmers (like you!) in the R community take up the task of wrapping calls to an API with R code to make accessing that data from R possible. For example, <a href="https://CRAN.R-project.org/package=gutenbergr">gutenbergr</a> provides access to Project Gutenberg, <a href="https://CRAN.R-project.org/package=rtweet">rtweet</a> to Twitter, and <a href="https://CRAN.R-project.org/package=Rfacebook">Rfacebook</a> to Facebook.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<!-- RESOURCES:
- [rwhatsapp](https://github.com/JBGruber/rwhatsapp) work with personal chat history 
- 
-->
<section id="open-access" class="level3" data-number="5.2.1"><h3 data-number="5.2.1" class="anchored" data-anchor-id="open-access">
<span class="header-section-number">5.2.1</span> Open access</h3>
<p>Using R package interfaces, however, often requires some more knowledge about R objects and functions. Let’s take a look at how to access data from Project Gutenberg through the <code>gutenbergr</code> package. Along the way we will touch upon various functions and concepts that are key to working with the R data types vectors and data frames including filtering and writing tabular data to disk in plain-text format.</p>
<p>To get started let’s install and/ or load the <code>gutenbergr</code> package. If a package is not part of the R base library, we cannot assume that the user will have the package in their library. The standard approach for installing and then loading a package is by using the <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code> function and then calling <code><a href="https://rdrr.io/r/base/library.html">library()</a></code>.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-standard-install-load-gutenbergr_f9eb0b618cdc4f1c381a5082391b0fb2">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"gutenbergr"</span><span class="op">)</span> <span class="co"># install `gutenbergr` package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/gutenbergr/">gutenbergr</a></span><span class="op">)</span> <span class="co"># load the `gutenbergr` package</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This approach works just fine, but luck has it that there is an R package for installing and loading packages! The <a href="https://CRAN.R-project.org/package=pacman">pacman</a> package includes a set of functions for managing packages. A very useful one is <code>p_load()</code> which will look for a package on a system, load it if it is found, and install and then load it if it is not found. This helps potentially avoid using unnecessary bandwidth to install packages that may already exist on a user’s system. But, to use <code>pacman</code> we need to include the code to install and load it with the functions <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code> and <code><a href="https://rdrr.io/r/base/library.html">library()</a></code>. I’ve included some code that will mimic the behavior of <code>p_load()</code> for installing <code>pacman</code> itself, but as you can see it is not elegant, luckily it’s only used once as we add it to the SETUP section of our master file, <code>_pipeline.R</code>.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/install-load-pacman_e720900a4cd6a1a62a187fd37e17607e">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load `pacman`. If not installed, install then load.</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/trinker/pacman">"pacman"</a></span>, character.only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"pacman"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/trinker/pacman">"pacman"</a></span>, character.only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we have <code>pacman</code> installed and loaded into our R session, let’s use the <code>p_load()</code> function to make sure to install/ load the two packages we will need for the upcoming tasks. If you are following along with the <code>project_template</code>, add this code within the SETUP section of the <code>1_acquire_data.Rmd</code> file.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-p-load-packages_fe3e4be2ebbefd8a619bfe71619122a1">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Script-specific options or packages</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">tidyverse</span>, <span class="va">gutenbergr</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that the arguments <code>tidyverse</code> and <code>gutenbergr</code> are comma-separated but not quoted when using <code>p_load()</code>. When using <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code> to install, package names need to be quoted (character strings). <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> can take quotes or no quotes, but only one package at a time.</p>
</div>
</div>
<p>Project Gutenberg provides access to thousands of texts in the public domain. The <code>gutenbergr</code> package contains a set of tables, or <strong>data frames</strong> in R speak, that index the meta-data for these texts broken down by text (<code>gutenberg_metadata</code>), author (<code>gutenberg_authors</code>), and subject (<code>gutenberg_subjects</code>). I’ll use the <code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code> function loaded in the <a href="https://CRAN.R-project.org/package=tidyverse">tidyverse</a> package <a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> to summarize the structure of these data frames.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-glimpse-meta-data-gutenbergr_0111b81da25db727679974ba4c8e7ef6">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">glimpse</span><span class="op">(</span><span class="va">gutenberg_metadata</span><span class="op">)</span> <span class="co"># summarize text meta-data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Rows: 69,199
#&gt; Columns: 8
#&gt; $ gutenberg_id        &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,…
#&gt; $ title               &lt;chr&gt; "The Declaration of Independence of the United Sta…
#&gt; $ author              &lt;chr&gt; "Jefferson, Thomas", "United States", "Kennedy, Jo…
#&gt; $ gutenberg_author_id &lt;int&gt; 1638, 1, 1666, 3, 1, 4, NA, 3, 3, NA, 7, 7, 7, 8, …
#&gt; $ language            &lt;chr&gt; "en", "en", "en", "en", "en", "en", "en", "en", "e…
#&gt; $ gutenberg_bookshelf &lt;chr&gt; "Politics/American Revolutionary War/United States…
#&gt; $ rights              &lt;chr&gt; "Public domain in the USA.", "Public domain in the…
#&gt; $ has_text            &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TR…</code></pre>
</div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">glimpse</span><span class="op">(</span><span class="va">gutenberg_authors</span><span class="op">)</span> <span class="co"># summarize authors meta-data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Rows: 21,323
#&gt; Columns: 7
#&gt; $ gutenberg_author_id &lt;int&gt; 1, 3, 4, 5, 7, 8, 9, 10, 12, 14, 16, 17, 18, 20, 2…
#&gt; $ author              &lt;chr&gt; "United States", "Lincoln, Abraham", "Henry, Patri…
#&gt; $ alias               &lt;chr&gt; "U.S.A.", NA, NA, NA, "Dodgson, Charles Lutwidge",…
#&gt; $ birthdate           &lt;int&gt; NA, 1809, 1736, 1849, 1832, NA, 1819, 1860, 1805, …
#&gt; $ deathdate           &lt;int&gt; NA, 1865, 1799, 1931, 1898, NA, 1891, 1937, 1844, …
#&gt; $ wikipedia           &lt;chr&gt; "https://en.wikipedia.org/wiki/United_States", "ht…
#&gt; $ aliases             &lt;chr&gt; NA, "United States President (1861-1865)/Lincoln, …</code></pre>
</div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">glimpse</span><span class="op">(</span><span class="va">gutenberg_subjects</span><span class="op">)</span> <span class="co"># summarize subjects meta-data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Rows: 230,993
#&gt; Columns: 3
#&gt; $ gutenberg_id &lt;int&gt; 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, …
#&gt; $ subject_type &lt;chr&gt; "lcsh", "lcsh", "lcc", "lcc", "lcsh", "lcsh", "lcc", "lcc…
#&gt; $ subject      &lt;chr&gt; "United States -- History -- Revolution, 1775-1783 -- Sou…</code></pre>
</div>
</div>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>gutenberg_metadata</code>, <code>gutenberg_authors</code>, and <code>gutenberg_subjects</code> are periodically updated. To check to see when each data frame was last updated run:</p>
<p><code>attr(gutenberg_metadata, "date_updated")</code></p>
</div>
</div>
<p>To download the text itself we use the <code><a href="https://docs.ropensci.org/gutenbergr/reference/gutenberg_download.html">gutenberg_download()</a></code> function which takes one required argument, <code>gutenberg_id</code>. The <code><a href="https://docs.ropensci.org/gutenbergr/reference/gutenberg_download.html">gutenberg_download()</a></code> function is what is known as ‘vectorized’, that is, it can take a single value or multiple values for the argument <code>gutenberg_id</code>. Vectorization refers to the process of applying a function to each of the elements stored in a <strong>vector</strong> –a primary object type in R. A vector is a grouping of values of one of various types including character (<code>chr</code>), integer (<code>int</code>), double (<code>dbl</code>), and logical (<code>lgl</code>) and a data frame is a grouping of vectors. The <code><a href="https://docs.ropensci.org/gutenbergr/reference/gutenberg_download.html">gutenberg_download()</a></code> function takes an integer vector which can be manually added or selected from the <code>gutenberg_metadata</code> or <code>gutenberg_subjects</code> data frames using the <code>$</code> operator (e.g.&nbsp;<code>gutenberg_metadata$gutenberg_id</code>).</p>
<p>Let’s first add them manually here as a toy example by generating a vector of integers from 1 to 5 assigned to the variable name <code>ids</code>.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-int-vector-ex_760eb9bd32fbf4f88aa525efa3a18ec9">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span> <span class="co"># integer vector of values 1 to 5</span></span>
<span><span class="va">ids</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 1 2 3 4 5</code></pre>
</div>
</div>
<p>To download the works from Project Gutenberg corresponding to the <code>gutenberg_id</code>s 1 to 5, we pass the <code>ids</code> object to the <code><a href="https://docs.ropensci.org/gutenbergr/reference/gutenberg_download.html">gutenberg_download()</a></code> function.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-download-ids-gutenbergr_a78be96a581ccf5dea1f374716f03d7b">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">works_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/gutenbergr/reference/gutenberg_download.html">gutenberg_download</a></span><span class="op">(</span>gutenberg_id <span class="op">=</span> <span class="va">ids</span><span class="op">)</span> <span class="co"># download works with `gutenberg_id` 1-5</span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">works_sample</span><span class="op">)</span> <span class="co"># summarize `works` dataset</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Rows: 2,959
#&gt; Columns: 2
#&gt; $ gutenberg_id &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
#&gt; $ text         &lt;chr&gt; "December, 1971  [Etext #1]", "", "", "The Project Gutenb…</code></pre>
</div>
</div>
<p>Two attributes are returned: <code>gutenberg_id</code> and <code>text</code>. The <code>text</code> column contains values for each line of text (delimited by a carriage return) for each of the 5 works we downloaded. There are many more attributes available from the Project Gutenberg API that can be accessed by passing a character vector of the attribute names to the argument <code>meta_fields</code>. The column names of the <code>gutenberg_metadata</code> data frame contains the available attributes.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-metadata-attributes-gutenbergr_29d2c691ca13c5dd4f7f5007b27c588c">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">gutenberg_metadata</span><span class="op">)</span> <span class="co"># print the column names of the `gutenberg_metadata` data frame</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "gutenberg_id"        "title"               "author"             
#&gt; [4] "gutenberg_author_id" "language"            "gutenberg_bookshelf"
#&gt; [7] "rights"              "has_text"</code></pre>
</div>
</div>
<p>Let’s augment our previous download with the title and author of each of the works. To create a character vector we use the <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> function, then, quote and delimit the individual elements of the vector with a comma.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-download-ids-meta-gutenbergr_53db695678d5d26424ca884da6fb50f8">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># download works with `gutenberg_id` 1-5 including `title` and `author` as attributes</span></span>
<span><span class="va">works_sample</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/gutenbergr/reference/gutenberg_download.html">gutenberg_download</a></span><span class="op">(</span>gutenberg_id <span class="op">=</span> <span class="va">ids</span>, meta_fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"title"</span>, <span class="st">"author"</span><span class="op">)</span><span class="op">)</span> <span class="co">#</span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">works_sample</span><span class="op">)</span> <span class="co"># summarize dataset</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Rows: 2,959
#&gt; Columns: 4
#&gt; $ gutenberg_id &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
#&gt; $ text         &lt;chr&gt; "December, 1971  [Etext #1]", "", "", "The Project Gutenb…
#&gt; $ title        &lt;chr&gt; "The Declaration of Independence of the United States of …
#&gt; $ author       &lt;chr&gt; "Jefferson, Thomas", "Jefferson, Thomas", "Jefferson, Tho…</code></pre>
</div>
</div>
<p>Now, in a more practical scenario we would like to select the values of <code>gutenberg_id</code> by some principled query such as works from a specific author, language, or subject. To do this we first query either the <code>gutenberg_metadata</code> data frame or the <code>gutenberg_subjects</code> data frame. Let’s say we want to download a random sample of 10 works from English Literature (Library of Congress Classification, “PR”). Using the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter()</a></code> function (<code>dplyr</code> is part of the <code>tidyverse</code> package set) we first extract all the Gutenberg ids from <code>gutenberg_subjects</code> where <code>subject_type == "lcc"</code> and <code>subject == "PR"</code> assigning the result to <code>ids</code>.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-eng-lit-subjects-gutenbergr_583a57f1186ffd398257585391da2a4d">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># filter for only English literature</span></span>
<span><span class="va">ids</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">gutenberg_subjects</span>, <span class="va">subject_type</span> <span class="op">==</span> <span class="st">"lcc"</span>, <span class="va">subject</span> <span class="op">==</span> <span class="st">"PR"</span><span class="op">)</span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">ids</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Rows: 9,900
#&gt; Columns: 3
#&gt; $ gutenberg_id &lt;int&gt; 11, 12, 13, 16, 20, 26, 27, 35, 36, 42, 43, 46, 58, 60, 8…
#&gt; $ subject_type &lt;chr&gt; "lcc", "lcc", "lcc", "lcc", "lcc", "lcc", "lcc", "lcc", "…
#&gt; $ subject      &lt;chr&gt; "PR", "PR", "PR", "PR", "PR", "PR", "PR", "PR", "PR", "PR…</code></pre>
</div>
</div>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The operators <code>=</code> and <code>==</code> are not equivalents. <code>==</code> is used for logical evaluation and <code>=</code> is an alternate notation for variable assignment (<code>&lt;-</code>).</p>
</div>
</div>
<p>The <code>gutenberg_subjects</code> data frame does not contain information as to whether a <code>gutenberg_id</code> is associated with a plain-text version. To limit our query to only those English Literature works with text, we filter the <code>gutenberg_metadata</code> data frame by the ids we have selected in <code>ids</code> and the attribute <code>has_text</code> in the <code>gutenberg_metadata</code> data frame.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-eng-lit-subjects-text-gutenbergr_1944e33a3c3c536963a96d2a397d8f57">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Filter for only those works that have text</span></span>
<span><span class="va">ids_has_text</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">gutenberg_metadata</span>, </span>
<span>         <span class="va">gutenberg_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">ids</span><span class="op">$</span><span class="va">gutenberg_id</span>, </span>
<span>         <span class="va">has_text</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">ids_has_text</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Rows: 9,548
#&gt; Columns: 8
#&gt; $ gutenberg_id        &lt;int&gt; 11, 12, 13, 16, 20, 26, 27, 35, 36, 42, 43, 46, 58…
#&gt; $ title               &lt;chr&gt; "Alice's Adventures in Wonderland", "Through the L…
#&gt; $ author              &lt;chr&gt; "Carroll, Lewis", "Carroll, Lewis", "Carroll, Lewi…
#&gt; $ gutenberg_author_id &lt;int&gt; 7, 7, 7, 10, 17, 17, 23, 30, 30, 35, 35, 37, 17, 4…
#&gt; $ language            &lt;chr&gt; "en", "en", "en", "en", "en", "en", "en", "en", "e…
#&gt; $ gutenberg_bookshelf &lt;chr&gt; "Children's Literature", "Best Books Ever Listings…
#&gt; $ rights              &lt;chr&gt; "Public domain in the USA.", "Public domain in the…
#&gt; $ has_text            &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TR…</code></pre>
</div>
</div>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>A couple R programming notes on the code phrase <code>gutenberg_id %in% ids$gutenberg_id</code>. First, the <code>$</code> symbol in <code>ids$gutenberg_id</code> is the programmatic way to target a particular column in an R data frame. In this example we select the <code>ids</code> data frame and the column <code>gutenberg_id</code>, which is a integer vector. The <code>gutenberg_id</code> variable that precedes the <code>%in%</code> operator does not need an explicit reference to a data frame because the primary argument of the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function is this data frame (<code>gutenberg_metadata</code>). Second, the <code>%in%</code> operator logically evaluates whether the vector elements in <code>gutenberg_metadata$gutenberg_ids</code> are also found in the vector <code>ids$gutenberg_id</code> returning <code>TRUE</code> and <code>FALSE</code> accordingly. This effectively filters those ids which are not in both vectors.</p>
</div>
</div>
<p>As we can see the number of works with text is fewer than the number of works listed, 9900 versus 9548. Now we can safely do our random selection of 10 works, with the function <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample()</a></code> and be confident that the ids we select will contain text when we take the next step by downloading the data.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-select-eng-lit-gutenbergr_99ca763f027c93ff68b523a33e2aee94">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span> <span class="co"># make the sampling reproducible</span></span>
<span><span class="va">ids_sample</span> <span class="op">&lt;-</span> <span class="fu">slice_sample</span><span class="op">(</span><span class="va">ids_has_text</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># sample 10 works</span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">ids_sample</span><span class="op">)</span> <span class="co"># summarize the dataset</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Rows: 10
#&gt; Columns: 8
#&gt; $ gutenberg_id        &lt;int&gt; 10542, 10734, 60253, 13776, 7532, 67002, 16604, 28…
#&gt; $ title               &lt;chr&gt; "The Boats of the \"Glen Carrig\"\r\nBeing an acco…
#&gt; $ author              &lt;chr&gt; "Hodgson, William Hope", NA, "Orczy, Emmuska Orczy…
#&gt; $ gutenberg_author_id &lt;int&gt; 3260, NA, 45, NA, NA, 30, 3579, 6137, 797, 1865
#&gt; $ language            &lt;chr&gt; "en", "en", "en", "en", "en", "hu", "en", "en", "e…
#&gt; $ gutenberg_bookshelf &lt;chr&gt; "Horror", NA, NA, NA, NA, NA, NA, "Humor", NA, NA
#&gt; $ rights              &lt;chr&gt; "Public domain in the USA.", "Public domain in the…
#&gt; $ has_text            &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TR…</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-eng-lit-download-gutenbergr_e612601ff92fe61049bbf141ec9e8625">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">works_pr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/gutenbergr/reference/gutenberg_download.html">gutenberg_download</a></span><span class="op">(</span>gutenberg_id <span class="op">=</span> <span class="va">ids_sample</span><span class="op">$</span><span class="va">gutenberg_id</span>, </span>
<span>                               meta_fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"author"</span>, <span class="st">"title"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">works_pr</span><span class="op">)</span> <span class="co"># summarize the dataset</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-eng-lit-download-gutenbergr-save_14a021eccfb1544abea92cc5fa0a2a35">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">works_pr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/gutenbergr/reference/gutenberg_download.html">gutenberg_download</a></span><span class="op">(</span>gutenberg_id <span class="op">=</span> <span class="va">ids_sample</span><span class="op">$</span><span class="va">gutenberg_id</span>, </span>
<span>                               meta_fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"author"</span>, <span class="st">"title"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">write_rds</span><span class="op">(</span><span class="va">works_pr</span>, file <span class="op">=</span> <span class="st">"data/acquire-data/gutenberg_works_pr.rds"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-eng-lit-download-gutenbergr-show_5bfc1ef23dbcd98cdaff438b9be6468d">
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Rows: 86,086
#&gt; Columns: 4
#&gt; $ gutenberg_id &lt;int&gt; 7532, 7532, 7532, 7532, 7532, 7532, 7532, 7532, 7532, 753…
#&gt; $ text         &lt;chr&gt; "A BOOK OF OLD BALLADS", "", "Selected and with an Introd…
#&gt; $ author       &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
#&gt; $ title        &lt;chr&gt; "A Book of Old Ballads — Volume 2", "A Book of Old Ballad…</code></pre>
</div>
</div>
<p>At this point we have data and could move on to processing this dataset in preparation for analysis. However, we are aiming for a reproducible workflow and this code does not conform to our principle of modularity: each subsequent step in our analysis will depend on running this code first. Furthermore, running this code as it is creates issues with bandwidth, as in our previous examples from direct downloads. To address modularity we will write the dataset to disk in <strong>plain-text format</strong>. In this way each subsequent step in our analysis can access the dataset locally. To address bandwidth concerns, we will devise a method for checking to see if the dataset is already downloaded and skip the download, if possible, to avoid accessing the Project Gutenberg server unnecessarily.</p>
<p>To write our data frame to disk we will export it into a standard plain-text format for two-dimensional datasets: a CSV file (comma-separated value). The CSV structure for this dataset will look like this:</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-csv-snippet_e03b71ec8bd649a6f790212f54bcd266">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">works_pr</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">format_csv</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; gutenberg_id,text,author,title
#&gt; 7532,A BOOK OF OLD BALLADS,NA,A Book of Old Ballads — Volume 2
#&gt; 7532,,NA,A Book of Old Ballads — Volume 2
#&gt; 7532,Selected and with an Introduction,NA,A Book of Old Ballads — Volume 2
#&gt; 7532,,NA,A Book of Old Ballads — Volume 2
#&gt; 7532,by,NA,A Book of Old Ballads — Volume 2
#&gt; 7532,,NA,A Book of Old Ballads — Volume 2</code></pre>
</div>
</div>
<p>The first line contains the names of the columns and subsequent lines the observations. Data points that contain commas themselves (e.g.&nbsp;“Shaw, Bernard”) are quoted to avoid misinterpreting these commas a deliminators in our data. To write this dataset to disk we will use the <code>reader::write_csv()</code> function.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-write-csv-brit_814c7877e5e62c553cb8e346ac124d40">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">write_csv</span><span class="op">(</span><span class="va">works_pr</span>, file <span class="op">=</span> <span class="st">"../data/original/gutenberg_works_pr.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To avoid downloading dataset that already resides on disk, let’s implement a similar strategy to the one used for direct downloads (<code>get_zip_data()</code>). I’ve incorporated the code for sampling and downloading data for a particular subject from Project Gutenberg with a control statement to check if the dataset file already exists into a function I named <code>get_gutenberg_subject()</code>. Take a look at this function below.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-get-gutenberg-subject-fun_b64cd888ac680b397d172cf30690481f">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">get_gutenberg_subject</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">subject</span>, <span class="va">target_file</span>, <span class="va">sample_size</span> <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Function: to download texts from Project Gutenberg with </span></span>
<span>  <span class="co"># a specific LCC subject and write the data to disk.</span></span>
<span>  </span>
<span>  <span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">tidyverse</span>, <span class="va">gutenbergr</span><span class="op">)</span> <span class="co"># install/load necessary packages</span></span>
<span>  </span>
<span>  <span class="co"># Check to see if the data already exists</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">target_file</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="co"># if data does not exist, download and write</span></span>
<span>    <span class="va">target_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html">dirname</a></span><span class="op">(</span><span class="va">target_file</span><span class="op">)</span> <span class="co"># generate target directory for the .csv file</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">target_dir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># create target data directory</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Downloading data... \n"</span><span class="op">)</span> <span class="co"># print status message</span></span>
<span>    <span class="co"># Select all records with a particular LCC subject</span></span>
<span>    <span class="va">ids</span> <span class="op">&lt;-</span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">gutenberg_subjects</span>, </span>
<span>             <span class="va">subject_type</span> <span class="op">==</span> <span class="st">"lcc"</span>, <span class="va">subject</span> <span class="op">==</span> <span class="va">subject</span><span class="op">)</span> <span class="co"># select subject</span></span>
<span>    <span class="co"># Select only those records with plain text available</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span> <span class="co"># make the sampling reproducible</span></span>
<span>    <span class="va">ids_sample</span> <span class="op">&lt;-</span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">gutenberg_metadata</span>, </span>
<span>             <span class="va">gutenberg_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">ids</span><span class="op">$</span><span class="va">gutenberg_id</span>, <span class="co"># select ids in both data frames </span></span>
<span>             <span class="va">has_text</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># select those ids that have text</span></span>
<span>      <span class="fu">slice_sample</span><span class="op">(</span>n <span class="op">=</span> <span class="va">sample_size</span><span class="op">)</span> <span class="co"># sample N works </span></span>
<span>    <span class="co"># Download sample with associated `author` and `title` metadata</span></span>
<span>    <span class="va">works_sample</span> <span class="op">&lt;-</span> </span>
<span>      <span class="fu"><a href="https://docs.ropensci.org/gutenbergr/reference/gutenberg_download.html">gutenberg_download</a></span><span class="op">(</span>gutenberg_id <span class="op">=</span> <span class="va">ids_sample</span><span class="op">$</span><span class="va">gutenberg_id</span>, </span>
<span>                         meta_fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"author"</span>, <span class="st">"title"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="co"># Write the dataset to disk in .csv format</span></span>
<span>    <span class="fu">write_csv</span><span class="op">(</span><span class="va">works_sample</span>, file <span class="op">=</span> <span class="va">target_file</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Data downloaded! \n"</span><span class="op">)</span> <span class="co"># print status message</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> <span class="co"># if data exists, don't download it again</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Data already exists \n"</span><span class="op">)</span> <span class="co"># print status message</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Adding this function to our function script <code>functions/acquire_functions.R</code>, we can now source this function in our <code>analysis/1_acquire_data.Rmd</code> script to download multiple subjects and store them in on disk in their own file.</p>
<p>Let’s download American Literature now (LCC code “PQ”).</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-get-am-lit_7912d5927394b4ab396fbaa718b2efba">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Download Project Gutenberg text for subject 'PQ' (American Literature)</span></span>
<span><span class="co"># and then write this dataset to disk in .rds format</span></span>
<span></span>
<span><span class="co"># Select all records with a particular LCC subject</span></span>
<span><span class="va">ids</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">gutenberg_subjects</span>, </span>
<span>         <span class="va">subject_type</span> <span class="op">==</span> <span class="st">"lcc"</span>, <span class="va">subject</span> <span class="op">==</span> <span class="st">"PQ"</span><span class="op">)</span> <span class="co"># select subject</span></span>
<span><span class="co"># Select only those records with plain text available</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span> <span class="co"># make the sampling reproducible</span></span>
<span><span class="va">ids_sample</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">gutenberg_metadata</span>, </span>
<span>         <span class="va">gutenberg_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">ids</span><span class="op">$</span><span class="va">gutenberg_id</span>, <span class="co"># select ids in both data frames </span></span>
<span>         <span class="va">has_text</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># select those ids that have text</span></span>
<span>  <span class="fu">slice_sample</span><span class="op">(</span>n <span class="op">=</span> <span class="va">sample_size</span><span class="op">)</span> <span class="co"># sample N works </span></span>
<span><span class="co"># Download sample with associated `author` and `title` metadata</span></span>
<span><span class="va">works_pq</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/gutenbergr/reference/gutenberg_download.html">gutenberg_download</a></span><span class="op">(</span>gutenberg_id <span class="op">=</span> <span class="va">ids_sample</span><span class="op">$</span><span class="va">gutenberg_id</span>, </span>
<span>                     meta_fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"author"</span>, <span class="st">"title"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">write_rds</span><span class="op">(</span>x <span class="op">=</span> <span class="va">works_pq</span>, file <span class="op">=</span> <span class="st">"data/acquire-data/gutenberg_works_pq.rds"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-get-am-lit-show_17b338f1508ecea7e094330cd604deb0">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Download Project Gutenberg text for subject 'PQ' (American Literature)</span></span>
<span><span class="co"># and then write this dataset to disk in .csv format</span></span>
<span><span class="fu">get_gutenberg_subject</span><span class="op">(</span>subject <span class="op">=</span> <span class="st">"PQ"</span>, target_file <span class="op">=</span> <span class="st">"../data/original/gutenberg/works_pq.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Applying this function to both the English and American Literature datasets, our data directory structure now looks like this:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> gutenberg</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── works_pq.csv</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   └── works_pr.csv</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> sbc</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── meta-data</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   └── transcriptions</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> scs</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> README</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> discourse</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> disfluency</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> documentation</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> tagged</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> timed-transcript</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> transcript</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section><section id="authentication" class="level3" data-number="5.2.2"><h3 data-number="5.2.2" class="anchored" data-anchor-id="authentication">
<span class="header-section-number">5.2.2</span> Authentication</h3>
<!-- Other APIs:

- News API https://newsapi.org/ with newsanchor package 

-->
<p>Some APIs and the R interfaces that provide access to them require authentication. This may either be through an interactive process that is mediated between R and the web service and/ or by visiting the developer website of the particular API. In either case, there is an extra step that is necessary to make the connect to the API to access the data.</p>
<p>Let’s take a look at the popular micro-blogging platform Twitter. The rtweet package <span class="citation" data-cites="R-rtweet">(<a href="references.html#ref-R-rtweet" role="doc-biblioref">Kearney, Revilla Sancho, and Wickham 2023</a>)</span> provides access to tweets in various ways. To get started install and/or load the rtweet package.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-p-load-rtweet_ffb5dec40e945a02b9f7e1cb39a19b19">
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">rtweet</span><span class="op">)</span> <span class="co"># install/load rtweet package</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now before a researcher can access data from Twitter with rtweet, <a href="https://docs.ropensci.org/rtweet/articles/auth.html">an authentication token must be setup and made accessible</a>. After following the steps for setting up an authentication token and saving it, that token can be accessed with the <code><a href="https://docs.ropensci.org/rtweet/reference/auth_as.html">auth_as()</a></code> function.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-auth-as-rtweet_0751da72a00ca937371305f4d37a920c">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">auth_as</span><span class="op">(</span><span class="va">twitter_auth</span><span class="op">)</span> <span class="co"># load the saved `twitter_auth` token</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we the R session is authenticated, we can explore a popular method for querying the Twitter API which searchs tweets (<code>search_tweets</code>) posted in the recent past (6-9 days).</p>
<p>Let’s look at a typical query using the <code><a href="https://docs.ropensci.org/rtweet/reference/search_tweets.html">search_tweets()</a></code> function.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-rtweet-search-latinx_dbe18b83497feb407f5ad05cc8947bcb">
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rt_latinx</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">search_tweets</span><span class="op">(</span>q <span class="op">=</span> <span class="st">"latinx"</span>, <span class="co"># query term</span></span>
<span>                n <span class="op">=</span> <span class="fl">100</span>, <span class="co"># number of tweets desired</span></span>
<span>                type <span class="op">=</span> <span class="st">"mixed"</span>, <span class="co"># a mix of `recent` and `popular` tweets</span></span>
<span>                include_rts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># do not include RTs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-rtweet-search-latinx-copy_0f2fef124fbee9ef40e89612855e241c">

</div>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-rtweet-search-latinx-read_65314671e2375b2058fd835550792c84">

</div>
<p>Looking at the arguments in this function, we see I’ve specified the query term to be ‘latinx’. This is a single word query but if the query included multiple words, the spaces between would be interpreted as the logical <code>AND</code> (only match tweets with all the individual terms). If one would like to include multi-word expressions, the expressions should be enclosed by single quotes (i.e.&nbsp;<code>q = "'spanish speakers' AND latinx"</code>). Another approach would be to include the logical <code>OR</code> (match tweets with either of the terms). Multi-word expressions can be included as in the previous case. Of note, hashtags are acceptable terms, so <code>q = "#latinx"</code> would match tweets with this hashtag.</p>
<p>The number of results has been set at ‘100’, but this is the default, so I could have left it out. But you can increase the number of desired tweets. There are rate limits which cap the number of tweets you can access in a given 15-minute time period.</p>
<p>Another argument of importance is the <code>type</code> argument. This argument has three possible attributes <code>popular</code>, <code>recent</code>, and <code>mixed</code>. When the <code>popular</code> attribute he Twitter API will tend to return fewer tweets than specified by <code>n</code>. With <code>recent</code> or <code>mixed</code> you will most likely get the <code>n</code> you specified (note that <code>mixed</code> is a mix of <code>popular</code> and <code>recent</code>).</p>
<p>A final argument to note is the <code>include_rts</code> whose attribute is logical. If <code>FALSE</code> no retweets will be included in the results. This is often what a language researcher will want.</p>
<p>Now, once the <code>search_tweets</code> query has been run, there a a large number of variables that are included in the resulting data frame. Here’s an overview of the names of the variables and the vector types for each variable.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/tbl-ad-rtweet-variables-table_ce844f852b5d695cf574bfec53d332aa">
<div class="cell-output-display">
<div id="tbl-ad-rtweet-variables-table" class="anchored">
<table class="table table-sm table-striped">
<caption>Table&nbsp;5.1: Variables and variable types returned from Twitter API via rtweet’s <code><a href="https://docs.ropensci.org/rtweet/reference/search_tweets.html">search_tweets()</a></code> function.</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">created_at</td>
<td style="text-align: left;">character</td>
</tr>
<tr class="even">
<td style="text-align: left;">id</td>
<td style="text-align: left;">double</td>
</tr>
<tr class="odd">
<td style="text-align: left;">id_str</td>
<td style="text-align: left;">character</td>
</tr>
<tr class="even">
<td style="text-align: left;">full_text</td>
<td style="text-align: left;">character</td>
</tr>
<tr class="odd">
<td style="text-align: left;">truncated</td>
<td style="text-align: left;">logical</td>
</tr>
<tr class="even">
<td style="text-align: left;">display_text_range</td>
<td style="text-align: left;">double</td>
</tr>
<tr class="odd">
<td style="text-align: left;">entities</td>
<td style="text-align: left;">list</td>
</tr>
<tr class="even">
<td style="text-align: left;">metadata</td>
<td style="text-align: left;">list</td>
</tr>
<tr class="odd">
<td style="text-align: left;">source</td>
<td style="text-align: left;">character</td>
</tr>
<tr class="even">
<td style="text-align: left;">in_reply_to_status_id</td>
<td style="text-align: left;">double</td>
</tr>
<tr class="odd">
<td style="text-align: left;">in_reply_to_status_id_str</td>
<td style="text-align: left;">character</td>
</tr>
<tr class="even">
<td style="text-align: left;">in_reply_to_user_id</td>
<td style="text-align: left;">double</td>
</tr>
<tr class="odd">
<td style="text-align: left;">in_reply_to_user_id_str</td>
<td style="text-align: left;">character</td>
</tr>
<tr class="even">
<td style="text-align: left;">in_reply_to_screen_name</td>
<td style="text-align: left;">character</td>
</tr>
<tr class="odd">
<td style="text-align: left;">geo</td>
<td style="text-align: left;">logical</td>
</tr>
<tr class="even">
<td style="text-align: left;">coordinates</td>
<td style="text-align: left;">list</td>
</tr>
<tr class="odd">
<td style="text-align: left;">place</td>
<td style="text-align: left;">list</td>
</tr>
<tr class="even">
<td style="text-align: left;">contributors</td>
<td style="text-align: left;">logical</td>
</tr>
<tr class="odd">
<td style="text-align: left;">is_quote_status</td>
<td style="text-align: left;">logical</td>
</tr>
<tr class="even">
<td style="text-align: left;">retweet_count</td>
<td style="text-align: left;">integer</td>
</tr>
<tr class="odd">
<td style="text-align: left;">favorite_count</td>
<td style="text-align: left;">integer</td>
</tr>
<tr class="even">
<td style="text-align: left;">favorited</td>
<td style="text-align: left;">logical</td>
</tr>
<tr class="odd">
<td style="text-align: left;">retweeted</td>
<td style="text-align: left;">logical</td>
</tr>
<tr class="even">
<td style="text-align: left;">lang</td>
<td style="text-align: left;">character</td>
</tr>
<tr class="odd">
<td style="text-align: left;">possibly_sensitive</td>
<td style="text-align: left;">logical</td>
</tr>
<tr class="even">
<td style="text-align: left;">quoted_status_id</td>
<td style="text-align: left;">double</td>
</tr>
<tr class="odd">
<td style="text-align: left;">quoted_status_id_str</td>
<td style="text-align: left;">character</td>
</tr>
<tr class="even">
<td style="text-align: left;">quoted_status</td>
<td style="text-align: left;">list</td>
</tr>
<tr class="odd">
<td style="text-align: left;">text</td>
<td style="text-align: left;">character</td>
</tr>
<tr class="even">
<td style="text-align: left;">favorited_by</td>
<td style="text-align: left;">logical</td>
</tr>
<tr class="odd">
<td style="text-align: left;">display_text_width</td>
<td style="text-align: left;">logical</td>
</tr>
<tr class="even">
<td style="text-align: left;">retweeted_status</td>
<td style="text-align: left;">logical</td>
</tr>
<tr class="odd">
<td style="text-align: left;">quoted_status_permalink</td>
<td style="text-align: left;">logical</td>
</tr>
<tr class="even">
<td style="text-align: left;">query</td>
<td style="text-align: left;">logical</td>
</tr>
<tr class="odd">
<td style="text-align: left;">possibly_sensitive_appealable</td>
<td style="text-align: left;">logical</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The <a href="https://developer.twitter.com/en/docs/twitter-api/v1/tweets/search/api-reference/get-search-tweets">Twitter API documentation for the standard Search Tweets call</a>, which is what <code><a href="https://docs.ropensci.org/rtweet/reference/search_tweets.html">search_tweets()</a></code> interfaces with has quite a few variables (35 to be exact). For many purposes it is not necessary to keep all the variables. Furthermore, since we will want to write a plain-text file to disk as part of our project, we will need to either convert or eliminate any of the variables that are marked as type <code>list</code>. The most common variable to convert is the <code>coordinates</code> variable, as it will contain the geolocation codes for those Twitter users’ tweets captured in the query that have geolocation enabled on their device. It is of note, however, that using <code><a href="https://docs.ropensci.org/rtweet/reference/search_tweets.html">search_tweets()</a></code> without specifying that only tweets with geocodes should be captured (<code>geocode =</code>) will tend to return very few, if any, tweets with geolocation information as the majority of Twitter users do not have geolocation enabled.</p>
<p>Let’s assume that we want to keep all the variables that are not of type <code>list</code>. One option is to use <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> and name each variable we want to keep. On the other hand we can use a combination of <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> and negated <code>!where()</code> to select all the variables that are not lists (<code>is_list</code>). Let’s do the later approach.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-rtweet-select-not-list_2d114c040ec0817302d6808bcd42d662">
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rt_latinx_subset</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">rt_latinx</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">!</span><span class="fu">where</span><span class="op">(</span><span class="va">is_list</span><span class="op">)</span><span class="op">)</span>  <span class="co"># select all variables that are NOT lists</span></span>
<span></span>
<span><span class="va">rt_latinx_subset</span> <span class="op">|&gt;</span> <span class="co"># subsetted dataset</span></span>
<span>  <span class="fu">glimpse</span><span class="op">(</span><span class="op">)</span> <span class="co"># overview</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Rows: 100
#&gt; Columns: 30
#&gt; $ created_at                    &lt;chr&gt; "Sun Sep 26 17:38:06 +0000 2021", "Sun S…
#&gt; $ id                            &lt;dbl&gt; 1.44e+18, 1.44e+18, 1.44e+18, 1.44e+18, …
#&gt; $ id_str                        &lt;chr&gt; "1442181701967302659", "1442196629801488…
#&gt; $ full_text                     &lt;chr&gt; "If we call it Latinx Mass they can't ca…
#&gt; $ truncated                     &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE…
#&gt; $ display_text_range            &lt;dbl&gt; 57, 177, 166, 23, 261, 153, 202, 211, 57…
#&gt; $ source                        &lt;chr&gt; "&lt;a href=\"https://mobile.twitter.com\" …
#&gt; $ in_reply_to_status_id         &lt;dbl&gt; NA, NA, NA, 1.44e+18, NA, NA, NA, NA, 1.…
#&gt; $ in_reply_to_status_id_str     &lt;chr&gt; NA, NA, NA, "1437436224042635269", NA, N…
#&gt; $ in_reply_to_user_id           &lt;dbl&gt; NA, NA, NA, 4.26e+08, NA, NA, NA, NA, 2.…
#&gt; $ in_reply_to_user_id_str       &lt;chr&gt; NA, NA, NA, "426159377", NA, NA, NA, NA,…
#&gt; $ in_reply_to_screen_name       &lt;chr&gt; NA, NA, NA, "MorganStanley", NA, NA, NA,…
#&gt; $ geo                           &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#&gt; $ contributors                  &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#&gt; $ is_quote_status               &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, TRUE, FALSE,…
#&gt; $ retweet_count                 &lt;int&gt; 351, 124, 62, 0, 0, 0, 0, 0, 0, 0, 0, 1,…
#&gt; $ favorite_count                &lt;int&gt; 3902, 898, 280, 0, 0, 0, 0, 0, 0, 7, 0, …
#&gt; $ favorited                     &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE…
#&gt; $ retweeted                     &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE…
#&gt; $ lang                          &lt;chr&gt; "en", "en", "es", "en", "en", "en", "en"…
#&gt; $ possibly_sensitive            &lt;lgl&gt; NA, FALSE, FALSE, FALSE, FALSE, FALSE, F…
#&gt; $ quoted_status_id              &lt;dbl&gt; NA, NA, NA, NA, 1.44e+18, NA, NA, NA, NA…
#&gt; $ quoted_status_id_str          &lt;chr&gt; NA, NA, NA, NA, "1442475408058830856", N…
#&gt; $ text                          &lt;chr&gt; "If we call it Latinx Mass they can't ca…
#&gt; $ favorited_by                  &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#&gt; $ display_text_width            &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#&gt; $ retweeted_status              &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#&gt; $ quoted_status_permalink       &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#&gt; $ query                         &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#&gt; $ possibly_sensitive_appealable &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</code></pre>
</div>
</div>
<p>Now we have the 30 variables which can be written to disk as a plain-text file. Let’s go ahead a do this, but wrap it in a function that does all the work we’ve just laid out in one function. In addition we will check to see if the same query has been run, and skip running the query if the dataset is on disk.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-rtweet-write-search-tweets_dfec1cc6e171534c8b0f1f7de784fa5d">
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">write_search_tweets</span> <span class="op">&lt;-</span> </span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">query</span>, <span class="va">path</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">100</span>, <span class="va">type</span> <span class="op">=</span> <span class="st">"mixed"</span>, <span class="va">include_rts</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Function</span></span>
<span>    <span class="co"># Conduct a Twitter search query and write the results to a csv file</span></span>
<span>    </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="co"># check to see if the file already exists</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"File does not exist \n"</span><span class="op">)</span> <span class="co"># message</span></span>
<span>      </span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rtweet/">rtweet</a></span><span class="op">)</span> <span class="co"># to use Twitter API</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span> <span class="co"># to manipulate data</span></span>
<span>      </span>
<span>      <span class="fu"><a href="https://docs.ropensci.org/rtweet/reference/auth_get.html">auth_get</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># get authentication token</span></span>
<span>      </span>
<span>      <span class="va">results</span> <span class="op">&lt;-</span> <span class="co"># query results</span></span>
<span>        <span class="fu"><a href="https://docs.ropensci.org/rtweet/reference/search_tweets.html">search_tweets</a></span><span class="op">(</span>q <span class="op">=</span> <span class="va">query</span>, <span class="co"># query term</span></span>
<span>                      n <span class="op">=</span> <span class="va">n</span>, <span class="co"># number of tweets desired (default 100)</span></span>
<span>                      type <span class="op">=</span> <span class="va">type</span>, <span class="co"># type of query</span></span>
<span>                      include_rts <span class="op">=</span> <span class="va">include_rts</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># to include RTs</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is_list</span><span class="op">)</span><span class="op">)</span>  <span class="co"># remove list variables</span></span>
<span>      </span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html">dirname</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="co"># isolate directory and check if exists</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Creating directory \n"</span><span class="op">)</span> <span class="co"># message</span></span>
<span>        </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html">dirname</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span>, <span class="co"># isolate and create directory (remove file name)</span></span>
<span>                   recursive <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># create embedded directories if necessary</span></span>
<span>                   showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># do not report warnings</span></span>
<span>      <span class="op">}</span></span>
<span>      </span>
<span>      <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">results</span>, file <span class="op">=</span> <span class="va">path</span><span class="op">)</span> <span class="co"># write results to csv file </span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Twitter search results written to disk \n"</span><span class="op">)</span> <span class="co"># message</span></span>
<span>      </span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"File already exists! \n"</span><span class="op">)</span> <span class="co"># message</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s run this function with the same query as above.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-rtweet-latinx-function_0f3f7a3b0155437b0dde834e68d69cea">
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">write_search_tweets</span><span class="op">(</span>query <span class="op">=</span> <span class="st">"latinx"</span>, path <span class="op">=</span> <span class="st">"../data/original/twitter/rt_latinx.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And the appropriate directory structure and file have been written to disk.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data/original/twitter/</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> rt_latinx.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In sum, this subsection provided an overview to acquiring data from web service APIs through R packages. We took at closer look at the <code>gutenbergr</code> package which provides programmatic access to works available on Projec t Gutenberg and the <code>rtweet</code> package which provides authenticated access to Twitter. Working with package interfaces requires more knowledge of R including loading/ installing packages, working with vectors and data frames, and exporting data from an R session. We touched on these programming concepts and also outlined a method to create a reproducible workflow.</p>
</section></section><section id="web-scraping" class="level2" data-number="5.3"><h2 data-number="5.3" class="anchored" data-anchor-id="web-scraping">
<span class="header-section-number">5.3</span> Web scraping</h2>
<p>There are many resources available through manual and direct downloads from repositories and individual sites and R package interfaces to web resources with APIs, but these resources are relatively limited to the amount of public-facing textual data recorded on the web. In the case that you want to acquire data from webpages, R can be used to access the web programmatically through a process known as web scraping. The complexity of web scrapes can vary but in general it requires more advanced knowledge of R as well as the structure of the language of the web: HTML (Hypertext Markup Language).</p>
<section id="a-toy-example" class="level3" data-number="5.3.1"><h3 data-number="5.3.1" class="anchored" data-anchor-id="a-toy-example">
<span class="header-section-number">5.3.1</span> A toy example</h3>
<p>HTML is a cousin of XML (eXtensible Markup Language) and as such organizes web documents in a hierarchical format that is read by your browser as you navigate the web. Take for example the toy webpage I created as a demonstration in <a href="#fig-ad-example-webpage">Figure&nbsp;<span>5.3</span></a>.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/fig-ad-example-webpage_7be90c2442a5d5391ce1af0b69380454">
<div class="cell-output-display">
<div id="fig-ad-example-webpage" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figures/acquire-data/example-webpage.png" class="img-fluid figure-img" width="366"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5.3: Example web page.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The file accessed by my browser to render this webpage is <code>test.html</code> and in plain-text format looks like this:</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-html-structure_9b0fb902cd6e2f790365addac0699d88">
<div class="cell-output cell-output-stdout">
<pre><code>
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;My website&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div class="intro"&gt;
      &lt;p&gt;Welcome!&lt;/p&gt;
      &lt;p&gt;This is my first website. &lt;/p&gt;
    &lt;/div&gt;
    &lt;table&gt;
      &lt;tr&gt;
        &lt;td&gt;Contact me:&lt;/td&gt;
        &lt;td&gt;
          &lt;a href="mailto:francojc@wfu.edu"&gt;francojc@wfu.edu&lt;/a&gt;
        &lt;/td&gt;
      &lt;/tr&gt;
    &lt;/table&gt;
    &lt;div class="conc"&gt;
      &lt;p&gt;Good-bye!&lt;/p&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<p>Each element in this file is delineated by an opening and closing tag, <code>&lt;head&gt;&lt;/head&gt;</code>. Tags are nested within other tags to create the structural hierarchy. Tags can take class and id labels to distinguish them from other tags and often contain other attributes that dictate how the tag is to behave when rendered visually by a browser. For example, there are two <code>&lt;div&gt;</code> tags in our toy example: one has the label <code>class = "intro"</code> and the other <code>class = "conc"</code>. <code>&lt;div&gt;</code> tags are often used to separate sections of a webpage that may require special visual formatting. The <code>&lt;a&gt;</code> tag, on the other hand, creates a web link. As part of this tag’s function, it requires the attribute <code>href=</code> and a web protocol –in this case it is a link to an email address <code>mailto:francojc@wfu.edu</code>. More often than not, however, the <code>href=</code> contains a URL (Uniform Resource Locator). A working example might look like this: <code>&lt;a href="https://francojc.github.io/"&gt;My homepage&lt;/a&gt;</code>.</p>
<p>The aim of a web scrape is to download the HTML file, parse the document structure, and extract the elements containing the relevant information we wish to capture. Let’s attempt to extract some information from our toy example. To do this we will need the <a href="https://CRAN.R-project.org/package=rvest">rvest</a><span class="citation" data-cites="R-rvest">(<a href="references.html#ref-R-rvest" role="doc-biblioref">Wickham 2022</a>)</span> package. First, install/load the package, then, read and parse the HTML from the character vector named <code>web_file</code> assigning the result to <code>html</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">rvest</span><span class="op">)</span> <span class="co"># install/ load `rvest`</span></span>
<span></span>
<span><span class="va">html</span> <span class="op">&lt;-</span> <span class="fu">read_html</span><span class="op">(</span><span class="va">web_file</span><span class="op">)</span> <span class="co"># read raw html and parse to xml</span></span>
<span><span class="va">html</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; {html_document}
#&gt; &lt;html&gt;
#&gt; [1] &lt;head&gt;\n&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8 ...
#&gt; [2] &lt;body&gt;\n    &lt;div class="intro"&gt;\n      &lt;p&gt;Welcome!&lt;/p&gt;\n      &lt;p&gt;This is  ...</code></pre>
</div>
</div>
<p><code>read_html()</code> parses the raw HTML into an object of class <code>xml_document</code>. The summary output above shows that tags the HTML structure have been parsed into ‘elements’. The tag elements can be accessed by using the <code>html_elements()</code> function by specifying the tag to isolate.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">html</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">html_elements</span><span class="op">(</span><span class="st">"div"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; {xml_nodeset (2)}
#&gt; [1] &lt;div class="intro"&gt;\n      &lt;p&gt;Welcome!&lt;/p&gt;\n      &lt;p&gt;This is my first web ...
#&gt; [2] &lt;div class="conc"&gt;\n      &lt;p&gt;Good-bye!&lt;/p&gt;\n    &lt;/div&gt;</code></pre>
</div>
</div>
<p>Notice that <code>html_elements("div")</code> has returned both <code>div</code> tags. To isolate one of tags by its class, we add the class name to the tag separating it with a <code>.</code>.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-parse-html-toy-2_2db2c138efbcb1e91c2e43c7c80640a5">
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">html</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">html_elements</span><span class="op">(</span><span class="st">"div.intro"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; {xml_nodeset (1)}
#&gt; [1] &lt;div class="intro"&gt;\n      &lt;p&gt;Welcome!&lt;/p&gt;\n      &lt;p&gt;This is my first web ...</code></pre>
</div>
</div>
<p>Great. Now say we want to drill down and isolate the subordinate <code>&lt;p&gt;</code> nodes. We can add <code>p</code> to our node filter.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-parse-html-toy-3_c067ebb46dc02c823f3e7f98a06bb7c1">
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">html</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">html_elements</span><span class="op">(</span><span class="st">"div.intro p"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; {xml_nodeset (2)}
#&gt; [1] &lt;p&gt;Welcome!&lt;/p&gt;
#&gt; [2] &lt;p&gt;This is my first website. &lt;/p&gt;</code></pre>
</div>
</div>
<p>To extract the text contained within a node we use the <code>html_text()</code> function.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-parse-html-toy-4_4d2ec10654ed301981c81390dd6e3bf3">
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">html</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">html_elements</span><span class="op">(</span><span class="st">"div.intro p"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">html_text</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "Welcome!"                   "This is my first website. "</code></pre>
</div>
</div>
<p>The result is a character vector with two elements corresponding to the text contained in each <code>&lt;p&gt;</code> tag. If you were paying close attention you might have noticed that the second element in our vector includes extra whitespace after the period. To trim leading and trailing whitespace from text we can add the <code>trim = TRUE</code> argument to <code>html_text()</code>.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-parse-html-toy-5_cbd3acc546e3776fda9758232422e6cd">
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">html</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">html_elements</span><span class="op">(</span><span class="st">"div.intro p"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">html_text</span><span class="op">(</span>trim <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "Welcome!"                  "This is my first website."</code></pre>
</div>
</div>
<p>From here we would then work to organize the text into a format we want to store it in and write the results to disk. Let’s leave writing data to disk for later in the chapter. For now keep our focus on working with <code>rvest</code> to acquire data from html documents working with a more practical example.</p>
</section><section id="a-practical-example" class="level3" data-number="5.3.2"><h3 data-number="5.3.2" class="anchored" data-anchor-id="a-practical-example">
<span class="header-section-number">5.3.2</span> A practical example</h3>
<!-- update: change website to scrape -->
<!-- remember to remove `eval = FALSE` from code chunks to run -->
<p>With some basic understanding of HTML and how to use the <code>rvest</code> package, let’s turn to a realistic example. Say we want to acquire lyrics from the online music website and database <a href="https://www.last.fm/">last.fm</a>. The first step in any web scrape is to investigate the site and page(s) we want to scrape to ascertain if there any licensing restrictions. Many, but not all websites, will include a plain text file <a href="https://www.cloudflare.com/learning/bots/what-is-robots.txt/"><code>robots.txt</code></a> at the root of the main URL. This file is declares which webpages a ‘robot’ (including web scraping scripts) can and cannot access. We can use the <code>robotstxt</code> package to find out which URLs are accessible <a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>.</p>
<!-- change domain -->
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-web-permissions_e0cf8f297f5449df58fa8764d1412e0f">
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">robotstxt</span><span class="op">)</span> <span class="co"># load/ install `robotstxt`</span></span>
<span></span>
<span><span class="fu">paths_allowed</span><span class="op">(</span>paths <span class="op">=</span> <span class="st">"https://www.last.fm/"</span><span class="op">)</span> <span class="co"># check permissions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] TRUE</code></pre>
</div>
</div>
<!-- screenshot of page to scrape -->
<p>The next step includes identifying the URL we want to target and exploring the structure of the HTML document. Take the following webpage I have identified, seen in <a href="#fig-ad-example-lyrics-page-lastfm">Figure&nbsp;<span>5.4</span></a>.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/fig-ad-example-lyrics-page-lastfm_538eab9820ead0068cc2f20ec7d35eb8">
<div class="cell-output-display">
<div id="fig-ad-example-lyrics-page-lastfm" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figures/acquire-data/ad-lastfm-webpage-lyrics.png" class="img-fluid figure-img" width="1392"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5.4: Lyrics page from last.fm</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>As in our toy example, first we want to feed the HTML web address to the <code>read_html()</code> function to parse the tags into elements. We will then assign the result to <code>html</code>.</p>
<!-- rvest::read_html() -->
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-read-write-read-page-x_efedcfb19a497ad4a7a67b9cbc0f930b">

</div>
<!-- show code, but don't evaluate -->
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-read-page-lyrics-lastfm_c02582b5bc4301aa9d855f95720b1a7f">
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># read and parse html as an xml object</span></span>
<span><span class="va">lyrics_url</span> <span class="op">&lt;-</span> <span class="st">"https://www.last.fm/music/Radiohead/_/Karma+Police/+lyrics"</span></span>
<span><span class="va">html</span> <span class="op">&lt;-</span> <span class="fu">read_html</span><span class="op">(</span><span class="va">lyrics_url</span><span class="op">)</span> <span class="co"># read raw html and parse to xml</span></span>
<span><span class="va">html</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- show html object -->
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-print-html-lyrics-lastfm_2608d7dd4a576bbfb89fb38b107aff55">
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; {html_document}
#&gt; &lt;html lang="en" class="
#&gt;         no-js
#&gt;         playbar-masthead-release-shim
#&gt;         youtube-provider-not-ready
#&gt;     "&gt;
#&gt; [1] &lt;head&gt;\n&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8 ...
#&gt; [2] &lt;body&gt;\n&lt;div id="initial-tealium-data" data-require="tracking/tealium-uta ...</code></pre>
</div>
</div>
<p>At this point we have captured and parsed the raw HTML assigning it to the object named <code>html</code>. The next step is to identify the html elements that contain the information we want to extract from the page. To do this it is helpful to use a browser to inspect specific elements of the webpage. Your browser will be equipped with a command that you can enable by hovering your mouse over the element of the page you want to target and using a right click to select “Inspect” (Chrome) or “Inspect Element” (Safari, Brave). This will split your browser window vertical or horizontally showing you the raw HTML underlying the webpage.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/fig-ad-inspect-element-artist-lastfm_a15dfa421a3be22d704eab843c2a95ff">
<div class="cell-output-display">
<div id="fig-ad-inspect-element-artist-lastfm" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figures/acquire-data/ad-lastfm-artist-inspect.png" class="img-fluid figure-img" width="1392"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5.5: Using the “Inspect Element” command to explore raw html.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<!-- change class/ tag/ attribute appropriately -->
<p>From <a href="#fig-ad-inspect-element-artist-lastfm">Figure&nbsp;<span>5.5</span></a> we see that the element we want to target is contained within an <code>&lt;a&gt;&lt;/a&gt;</code> tag. Now this tag is common and we don’t want to extract every <code>a</code> so we use the class <code>header-new-crumb</code> to specify we only want the artist name. Using the convention described in our toy example, we can isolate the artist of the lyrics page.</p>
<!-- change class/ tag/ attribute appropriately -->
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-extract-artist-lastfm-1_ab1ee5e86dca3046b6af19342938c700">
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">html</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">html_element</span><span class="op">(</span><span class="st">"a.header-new-crumb"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; {html_node}
#&gt; &lt;a class="header-new-crumb" itemprop="url" href="/music/Radiohead"&gt;
#&gt; [1] &lt;span itemprop="name"&gt;Radiohead&lt;/span&gt;</code></pre>
</div>
</div>
<p>We can then extract the text with <code>html_text()</code>.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-extract-artist-lastfm-2_af9d19e18991b12ff4acfdc6c91e8230">
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">artist</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">html</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">html_element</span><span class="op">(</span><span class="st">"a.header-new-crumb"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">html_text</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">artist</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "Radiohead"</code></pre>
</div>
</div>
<p>Let’s extract the song title in the same way.</p>
<!-- change class/ tag/ attribute appropriately -->
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-extract-song-title_985369e9a0d263c02ad145e77ae3dfa5">
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">song</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">html</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">html_element</span><span class="op">(</span><span class="st">"h1.header-new-title"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">html_text</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">song</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "Karma Police"</code></pre>
</div>
</div>
<p>Now if we inspect the HTML of the lyrics page, we will notice that the lyrics are contained in <code>&lt;p&gt;&lt;/p&gt;</code> tags with the class <code>lyrics-paragraph</code>.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/fig-ad-inspect-element-lyrics-lastfm_9d6e234dc5a43ef2a15cf4eb00ec497d">
<div class="cell-output-display">
<div id="fig-ad-inspect-element-lyrics-lastfm" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figures/acquire-data/ad-lastfm-lyrics-inspect.png" class="img-fluid figure-img" width="1392"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5.6: Using the “Inspect Element” command to explore raw html.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Since there are multiple elements that we want to extract, we will need to use the <code>html_elements()</code> function instead of the <code>html_element()</code> which only targets one element.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-extract-lyrics_7620920bda2ee468144c5c9655bb3ffe">
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lyrics</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">html</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">html_elements</span><span class="op">(</span><span class="st">"p.lyrics-paragraph"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">html_text</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">lyrics</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "Karma policeArrest this manHe talks in mathsHe buzzes like a fridgeHe's like a detuned radio"      
#&gt; [2] "Karma policeArrest this girlHer Hitler hairdoIs making me feel illAnd we have crashed her party"   
#&gt; [3] "This is what you'll getThis is what you'll getThis is what you'll getWhen you mess with us"        
#&gt; [4] "Karma policeI've given all I canIt's not enoughI've given all I canBut we're still on the payroll" 
#&gt; [5] "This is what you'll getThis is what you'll getThis is what you'll getWhen you mess with us"        
#&gt; [6] "For a minute thereI lost myself, I lost myselfPhew, for a minute thereI lost myself, I lost myself"
#&gt; [7] "For a minute thereI lost myself, I lost myselfPhew, for a minute thereI lost myself, I lost myself"</code></pre>
</div>
</div>
<p>At this point, we have isolated and extracted the artist, song, and lyrics from the webpage. Each of these elements are stored in character vectors in our R session. To complete our task we need to write this data to disk as plain text. With an eye towards a tidy dataset, an ideal format to store the data is in a CSV file where each column corresponds to one of the elements from our scrape and each row an observation. A CSV file is a tabular format and so before we can write the data to disk let’s coerce the data that we have into tabular format. We will use the <code><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble()</a></code> function here to streamline our data frame creation. <a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a> Feeding each of the vectors <code>artist</code>, <code>song</code>, and <code>lyrics</code> as arguments to <code><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble()</a></code> creates the tabular format we are looking for.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-create-tibble-lastfm-1_265910fe32a58820e30d57200b61c2b2">
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">artist</span>, <span class="va">song</span>, <span class="va">lyrics</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Rows: 7
#&gt; Columns: 3
#&gt; $ artist &lt;chr&gt; "Radiohead", "Radiohead", "Radiohead", "Radiohead", "Radiohead"…
#&gt; $ song   &lt;chr&gt; "Karma Police", "Karma Police", "Karma Police", "Karma Police",…
#&gt; $ lyrics &lt;chr&gt; "Karma policeArrest this manHe talks in mathsHe buzzes like a f…</code></pre>
</div>
</div>
<p>Notice that there are seven rows in this data frame, one corresponding to each paragraph in <code>lyrics</code>. R has a bias towards working with vectors of the same length. As such each of the other vectors (<code>artist</code>, and <code>song</code>) are replicated, or recycled, until they are the same length as the longest vector <code>lyrics</code>, which a length of seven.</p>
<p>For good documentation let’s add our object <code>lyrics_url</code> to the data frame, which contains the actual web link to this page, and assign the result to <code>song_lyrics</code>.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-create-tibble-lastfm-2_fb84e1957eb5752faf290a985f6f9eff">
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">song_lyrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">artist</span>, <span class="va">song</span>, <span class="va">lyrics</span>, <span class="va">lyrics_url</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The final step is to write this data to disk. To do this we will use the <code><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv()</a></code> function.</p>
<!-- adjust target file -->
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-write-csv-lastfm_bd84d20d62ca2e294dc01da4df556826">
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">song_lyrics</span>, path <span class="op">=</span> <span class="st">"../data/original/lyrics.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="scaling-up" class="level3" data-number="5.3.3"><h3 data-number="5.3.3" class="anchored" data-anchor-id="scaling-up">
<span class="header-section-number">5.3.3</span> Scaling up</h3>
<p>At this point you may be think, ‘Great, I can download data from a single page, but what about downloading multiple pages?’ Good question. That’s really where the strength of a programming approach takes hold. Extracting information from multiple pages is not fundamentally different than working with a single page. However, it does require more sophisticated understanding of the web and R coding strategies, in particular <strong>iteration</strong>.</p>
<p>Before we get to iteration, let’s first create a couple functions to make it possible to efficiently reuse the code we have developed so far:</p>
<ol type="1">
<li>the <code>get_lyrics</code> function wraps the code for scraping a single lyrics webpage from last.fm.</li>
</ol>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-get-lyrics-function_d4c44d4a19e65d7026e2bd27d3c3a91d">
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">get_lyrics</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lyrics_url</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Function: Scrape last.fm lyrics page for: artist, song, </span></span>
<span>  <span class="co"># and lyrics from a provided content link. </span></span>
<span>  <span class="co"># Return as a tibble/data.frame</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Scraping song lyrics from:"</span>, <span class="va">lyrics_url</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">tidyverse</span>, <span class="va">rvest</span><span class="op">)</span> <span class="co"># install/ load package(s)</span></span>
<span>  </span>
<span>  <span class="va">url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/connections.html">url</a></span><span class="op">(</span><span class="va">lyrics_url</span>, <span class="st">"rb"</span><span class="op">)</span> <span class="co"># open url connection </span></span>
<span>  <span class="va">html</span> <span class="op">&lt;-</span> <span class="fu">read_html</span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="co"># read and parse html as an xml object</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/connections.html">close</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="co"># close url connection</span></span>
<span>  </span>
<span>  <span class="va">artist</span> <span class="op">&lt;-</span> </span>
<span>    <span class="va">html</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">html_element</span><span class="op">(</span><span class="st">"a.header-new-crumb"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">html_text</span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">song</span> <span class="op">&lt;-</span> </span>
<span>    <span class="va">html</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">html_element</span><span class="op">(</span><span class="st">"h1.header-new-title"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">html_text</span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">lyrics</span> <span class="op">&lt;-</span> </span>
<span>    <span class="va">html</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">html_elements</span><span class="op">(</span><span class="st">"p.lyrics-paragraph"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">html_text</span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"...one moment "</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="co"># sleep for 1 second to reduce server load</span></span>
<span>  </span>
<span>  <span class="va">song_lyrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">artist</span>, <span class="va">song</span>, <span class="va">lyrics</span>, <span class="va">lyrics_url</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"... done! \n"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">song_lyrics</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>get_lyrics</code> function includes all of the code developed previously, but also includes: (1) output messages (<code><a href="https://rdrr.io/r/base/cat.html">cat()</a></code>), (2) a processing pause (<code><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep()</a></code>), and (3) code to manage opening and closing web connections (<code><a href="https://rdrr.io/r/base/connections.html">url()</a></code> and <code><a href="https://rdrr.io/r/base/connections.html">close()</a></code>).</p>
<p>Points (1) and (2) will be useful when we iterate over this function to provide status messages and to reduce server load when processing multiple webpages from a web domain. (3) will be necessary to manage webpages that are non-existent. As we will see, we will generate url link to multiple song lyrics some of which will not be valid. To avoid errors that will stop the processing these steps have been incorporated here.</p>
</div>
</div>
<ol start="2" type="1">
<li>the <code>write_content</code> writes the webscraped data to our local machine, including functionality to create the necessary directory structure of the target file path we choose.</li>
</ol>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-write-content-function_32c4b6ab1575975e4acceb2297731315">
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">write_content</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">content</span>, <span class="va">target_file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Function: Write the tibble content to disk. Create the directory if</span></span>
<span>  <span class="co"># it does not already exist.</span></span>
<span>  </span>
<span>  <span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span> <span class="co"># install/ load packages</span></span>
<span>  </span>
<span>  <span class="va">target_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html">dirname</a></span><span class="op">(</span><span class="va">target_file</span><span class="op">)</span> <span class="co"># identify target file directory structure</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">target_dir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># create directory</span></span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">content</span>, <span class="va">target_file</span><span class="op">)</span> <span class="co"># write csv file to target location</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Content written to disk!\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With just these two functions, we can take a lyrics URL from last.fm and scrape and write the data to disk like this.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-get-write-single-lyric-lastfm_bb2b73f9fd649e0c39b26ab130fc734a">
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lyrics_url</span> <span class="op">&lt;-</span> <span class="st">"https://www.last.fm/music/Pixies/_/Where+Is+My+Mind%3F/+lyrics"</span></span>
<span></span>
<span><span class="va">lyrics_url</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">get_lyrics</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">write_content</span><span class="op">(</span>target_file <span class="op">=</span> <span class="st">"../data/original/lastfm/lyrics.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb101"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data/original/lastfm/</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> lyrics.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now we could manually search and copy URLs and run this function pipeline. This would be fine if we had just a few particular URLs that we wanted to scrape. But if we want to, say, scrape a set of lyrics grouped by genre. We would probably want a more programmatic approach. The good news is we can leverage our understanding of webscraping to scrape last.fm to harvest the information needed to create and store links to songs by genre. We can then pass these links to a pipeline, similar to the previous one, to scrape lyrics for many songs and store the results in files grouped by genre.</p>
<p>Last.fm provides a genres page where some of the top genres are listed and can be further explored.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/fig-ad-genre-page-lastfm_14a0582e60951b73dd335a28ad9e5abf">
<div class="cell-output-display">
<div id="fig-ad-genre-page-lastfm" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figures/acquire-data/ad-lastfm-genres.png" class="img-fluid figure-img" width="1392"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5.7: Genre page on last.fm</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Diving into a a particular genre, ‘rock’ for example, you will get a listing of the top tracks in that genre.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/fig-ad-genre-tracks-list-lastfm_68105f191b1576b2d64b7e011fbc24dd">
<div class="cell-output-display">
<div id="fig-ad-genre-tracks-list-lastfm" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="figures/acquire-data/ad-lastfm-genre-tracks-list.png" class="img-fluid figure-img" width="1392"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5.8: Tracks by genre list page on last.fm</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>If we inspect the HTML elements for the track names in <a href="#fig-ad-genre-tracks-list-lastfm">Figure&nbsp;<span>5.8</span></a>, we can see that a relative URL is found for the track. In this case, I have ‘Smells Like Teen Spirit’ by Nirvana highlighted in the inspector. If we follow this link to the track page and then to the lyrics for the track, you will notice that the relative URL on the track listings page has all the unique information. Only the web domain <code>https://www.last.fm</code> and the post-pended <code>/+lyrics</code> is missing.</p>
<p>So with this we can put together a function which gets the track listing for a last.fm genre, scrapes the relative URLs for each of the tracks, and creates a full absolute URL to the lyrics page.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-get-genre-lyrics-url-lastfm_9191586f12019043f7e874847c82b50a">
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">get_genre_lyrics_urls</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">last_fm_genre</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Function: Scrapes a given last.fm genre title for top tracks in</span></span>
<span>  <span class="co"># that genre and then creates links to the lyrics pages for these tracks</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Scraping top songs from:"</span>, <span class="va">last_fm_genre</span>, <span class="st">"genre: \n"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">tidyverse</span>, <span class="va">rvest</span><span class="op">)</span> <span class="co"># install/ load packages</span></span>
<span>  </span>
<span>  <span class="co"># create web url for the genre listing page</span></span>
<span>  <span class="va">genre_listing_url</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"https://www.last.fm/tag/"</span>, <span class="va">last_fm_genre</span>, <span class="st">"/tracks"</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="va">genre_lyrics_urls</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu">read_html</span><span class="op">(</span><span class="va">genre_listing_url</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># read raw html and parse to xml</span></span>
<span>    <span class="fu">html_elements</span><span class="op">(</span><span class="st">"td.chartlist-name a"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># isolate the track elements</span></span>
<span>    <span class="fu">html_attr</span><span class="op">(</span><span class="st">"href"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># extract the href attribute</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"https://www.last.fm"</span>, <span class="va">.</span>, <span class="st">"/+lyrics"</span><span class="op">)</span> <span class="co"># join the domain, relative artist path, and the post-pended /+lyrics to create an absolute URL</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">genre_lyrics_urls</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With this function, all we need is to identify the verbatim way last.fm lists the genres. For Rock, it is <code>rock</code> but for Hip Hop, it is <code>hip+hop</code>.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-save-get-genre-lyrics-urls-lastfm_a2df8441b39807b3c41ccaaf6b8eb3d4">

</div>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-demo-get-genre-lyrics-urls-lastfm_815859666cdfe3842ad87dc027ffe565">
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">get_genre_lyrics_urls</span><span class="op">(</span><span class="st">"hip+hop"</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># get urls for top hip hop tracks</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># only display 10 tracks</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-print-get-genre-lyrics-urls-lastfm_346f985b278a9c569352da0eacc5e333">
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Scraping top songs from: hip+hop genre:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] "https://www.last.fm/music/Juzhin/_/Charlie+Conscience+(feat.+MMAIO)/+lyrics"
#&gt;  [2] "https://www.last.fm/music/Juzhin/_/Railways/+lyrics"                        
#&gt;  [3] "https://www.last.fm/music/Juzhin/_/Coming+Down/+lyrics"                     
#&gt;  [4] "https://www.last.fm/music/Juzhin/_/Tupona/+lyrics"                          
#&gt;  [5] "https://www.last.fm/music/Juzhin/_/Sakhalin/+lyrics"                        
#&gt;  [6] "https://www.last.fm/music/Juzhin/_/3+Simple+Minutes/+lyrics"                
#&gt;  [7] "https://www.last.fm/music/Juzhin/_/Lost+Sense/+lyrics"                      
#&gt;  [8] "https://www.last.fm/music/Juzhin/_/Wonderful/+lyrics"                       
#&gt;  [9] "https://www.last.fm/music/Gina+Moryson/_/Vanilla+Smoothy+(Live)/+lyrics"    
#&gt; [10] "https://www.last.fm/music/Juzhin/_/Flunk-Down+(Juzhin+Remix)/+lyrics"</code></pre>
</div>
</div>
<p>So now we have a method to scrape URLs by genre and list them in a vector. Our approach, then, could be to pass these lyrics URLs to our existing pipeline which downloads the lyrics (<code>get_lyrics()</code>) and then writes them to disk (<code>write_content()</code>).</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-example-genre-pipeline-lastfm-1_ecab587630c01658a531b10f1fb47444">
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Note: will not run</span></span>
<span><span class="fu">get_genre_lyrics_urls</span><span class="op">(</span><span class="st">"hip+hop"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># get lyrics urls for specific genre</span></span>
<span>  <span class="fu">get_lyrics</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># scrape lyrics url</span></span>
<span>  <span class="fu">write_content</span><span class="op">(</span>target_file <span class="op">=</span> <span class="st">"../data/original/lastfm/hip_hop.csv"</span><span class="op">)</span> <span class="co"># write to disk</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This approach, however, has a couple of problems. (1) our <code>get_lyrics()</code> function only takes one URL at a time, but the result of <code>get_genre_lyrics_urls()</code> will produce many URLs. We will be able to solve this with iteration using the <a href="">purrr</a> package, specifically the <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> function which will iteratively map each URL output from <code>get_genre_lyrics_urls()</code> to <code>get_lyrics()</code> in turn. (2) the output from our iterative application of <code>get_lyrics()</code> will produce a tibble for each URL, which then sets up a problem with writing the tibbles to disk with the <code>write_content()</code> function. To avoid this we will want to combine the tibbles into one single tibble and then send it to be written to disk. The <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows()</a></code> function will do just this.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-example-genre-pipeline-lastfm-2_eb22c16ac64a8baa15c4bbb259e2922e">
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Note: will run, but with occasional errors</span></span>
<span><span class="fu">get_genre_lyrics_urls</span><span class="op">(</span><span class="st">"hip+hop"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># get lyrics urls for specific genre</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">get_lyrics</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># scrape lyrics url</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># combine tibbles into one</span></span>
<span>  <span class="fu">write_content</span><span class="op">(</span>target_file <span class="op">=</span> <span class="st">"../data/original/lastfm/hip_hop.csv"</span><span class="op">)</span> <span class="co"># write to disk</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This preceding pipeline conceptually will work. However, on my testing, it turns out that some of the URLs that are generated in the <code>get_genre_lyrics_urls()</code> do not exist on the site. That is, the song is listed but no lyrics have been added to the song site. This will mean that when the URL is sent to the <code>get_lyrics()</code> function, there will be an error when attempting to download and parse the page with <code>read_html()</code> which will halt the entire process. To avoid this error, we can wrap the <code>get_lyrics()</code> function in a function designed to attempt to download and parse the URL (<code><a href="https://rdrr.io/r/base/conditions.html">tryCatch()</a></code>), but if there is an error, it will skip it and move on to the next URL without stopping the processing. This approach is reflected in the <code>get_lyrics_catch()</code> function below.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-get-lyrics-catch-lastfm_5bd3995c0f1668ec41e0951663b14679">
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Wrap the `get_lyrics()` function with `tryCatch()` to </span></span>
<span><span class="co"># skip URLs that have no lyrics</span></span>
<span></span>
<span><span class="va">get_lyrics_catch</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lyrics_url</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span><span class="op">(</span><span class="fu">get_lyrics</span><span class="op">(</span><span class="va">lyrics_url</span><span class="op">)</span>, </span>
<span>           error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span><span class="op">)</span> <span class="co"># no, URL, return(NULL)/ skip</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Updating the pipeline with the <code>get_lyrics_catch()</code> function would look like this:</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-example-genre-pipeline-lastfm-3_4fc40728be169a0379dc91e7b7a819a9">
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Note: will run, but we can do better</span></span>
<span><span class="fu">get_genre_lyrics_urls</span><span class="op">(</span><span class="st">"hip+hop"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># get lyrics urls for specific genre</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">get_lyrics_catch</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># scrape lyrics url</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># combine tibbles into one</span></span>
<span>  <span class="fu">write_content</span><span class="op">(</span>target_file <span class="op">=</span> <span class="st">"../data/original/lastfm/hip_hop.csv"</span><span class="op">)</span> <span class="co"># write to disk</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will work, but as we have discussed before one of this goals we have we acquiring data for a reproducible research project is to make sure that we are developing efficient code that will not burden site’s server we are scraping from. In this case, we would like to check to see if the data is already downloaded. If not, then the script should run. If so, then the script does not run. Of course this is a perfect use of a conditional statement. To make this a single function we can call, I’ve wrapped the functions we created for getting lyric URLs from last.fm, scraping the URLs, and writing the results to disk in the <code>download_lastfm_lyrics()</code> function below. I also added a line to add a <code>last_fm_genre</code> column to the combined tibble to store the name of the genre we scraped (i.e.&nbsp;<code>mutate(genre = last_fm_genre)</code>.</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-download-lyrics-lastfm-function_4f4279580cbea7327f68a93c036e845e">
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">download_lastfm_lyrics</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">last_fm_genre</span>, <span class="va">target_file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Function: get last.fm lyric urls by genre and write them to disk</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">target_file</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Downloading data.\n"</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">get_genre_lyrics_urls</span><span class="op">(</span><span class="va">last_fm_genre</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">get_lyrics_catch</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>genre <span class="op">=</span> <span class="va">last_fm_genre</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu">write_content</span><span class="op">(</span><span class="va">target_file</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Data already downloaded!\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can call this function on any genre on the last.fm site and download the top 50 song lyrics for that genre (provided they all have lyrics pages).</p>
<div class="cell" data-layout-align="center" data-hash="acquire-data_cache/html/ad-download-lyrics-genre-lastfm-show_d28a14078c01291a60f2ab63f6a50fac">
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Scrape lyrics for 'pop'</span></span>
<span><span class="fu">download_lastfm_lyrics</span><span class="op">(</span>last_fm_genre <span class="op">=</span> <span class="st">"pop"</span>, target_file <span class="op">=</span> <span class="st">"../data/original/lastfm/pop.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Scrape lyrics for 'rock'</span></span>
<span><span class="fu">download_lastfm_lyrics</span><span class="op">(</span>last_fm_genre <span class="op">=</span> <span class="st">"rock"</span>, target_file <span class="op">=</span> <span class="st">"../data/original/lastfm/rock.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Scrape lyrics for 'hip hop'</span></span>
<span><span class="fu">download_lastfm_lyrics</span><span class="op">(</span>last_fm_genre <span class="op">=</span> <span class="st">"hip+hop"</span>, target_file <span class="op">=</span> <span class="st">"../data/original/lastfm/hip_hop.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Scrape lyrics for 'metal'</span></span>
<span><span class="fu">download_lastfm_lyrics</span><span class="op">(</span>last_fm_genre <span class="op">=</span> <span class="st">"metal"</span>, target_file <span class="op">=</span> <span class="st">"../data/original/lastfm/metal.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can see that our web scrape data is organized in a similar fashion to the other data we acquired in this chapter.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data/</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived/</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original/</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> cedel2/</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   └── texts.csv</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> gutenberg/</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── works_pq.csv</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   └── works_pr.csv</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> lastfm/</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── country.csv</span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── hip_hop.csv</span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── lyrics.csv</span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── metal.csv</span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── pop.csv</span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   └── rock.csv</span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> sbc/</span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── meta-data/</span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   └── transcriptions/</span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> scs/</span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── README</span>
<span id="cb112-21"><a href="#cb112-21" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── discourse</span>
<span id="cb112-22"><a href="#cb112-22" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── disfluency</span>
<span id="cb112-23"><a href="#cb112-23" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── documentation/</span>
<span id="cb112-24"><a href="#cb112-24" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── tagged</span>
<span id="cb112-25"><a href="#cb112-25" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── timed-transcript</span>
<span id="cb112-26"><a href="#cb112-26" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   └── transcript</span>
<span id="cb112-27"><a href="#cb112-27" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> twitter/</span>
<span id="cb112-28"><a href="#cb112-28" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> rt_latinx.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Again, it is important to add these custom functions to our <code>acquire_functions.R</code> script in the <code>functions/</code> directory so we can access them in our scripts more efficiently and make our analysis steps more succinct and legible.</p>
<p>In this section we covered scraping language data from the web. The rvest package provides a host of functions for downloading and parsing HTML. We first looked at a toy example to get a basic understanding of how HTML works and then moved to applying this knowledge to a practical example. To maintain a reproducible workflow, the code developed in this example was grouped into task-oriented functions which were in turn joined and wrapped into a function that provided convenient access to our workflow and avoided unnecessary downloads (in the case the data already exists on disk).</p>
<p>Here we have built on previously introduced R coding concepts and demonstrated various others. Web scraping often requires more knowledge of and familiarity with R as well as other web technologies. Rest assured, however, practice will increase confidence in your abilities. I encourage you to practice on your own with other websites. You will encounter problems. Consult the R documentation in RStudio or online and lean on the R community on the web at sites such as <a href="https://stackoverflow.com/">Stack Overflow</a> <em>inter alia</em>.</p>
</section></section><section id="documentation" class="level2" data-number="5.4"><h2 data-number="5.4" class="anchored" data-anchor-id="documentation">
<span class="header-section-number">5.4</span> Documentation</h2>
<p>As part of the data acquisition process it is important include documentation that describes the data resource(s) that will serve as the base for a research project. For all resources the data should include as much information possible that outlines the sampling frame of the data <span class="citation" data-cites="Adel2020">(<a href="references.html#ref-Adel2020" role="doc-biblioref">Ädel 2020</a>)</span>. For a corpus sample acquired from a repository will often include documentation which will outline the sampling frame –this most likely will be the very information which leads a researcher to select this resource for the project at hand. It is important to include this documentation (HTML or PDF file) or reference to the documentation (article citation or link<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a>) within the reproducible project’s directory structure.</p>
<p>In other cases where the data acquisition process is formulated and conducted by the researcher for the specific aims of the research (i.e.&nbsp;API and web scraping approaches), the researcher should make an effort to document those aspects which are key for the study, but that may also be of interest to other researchers for similar research questions. This will may include language characteristics such as modality, register, genre, etc., speaker/ writer characteristics such as demographics, time period(s), context of the linguistic communication, etc. and process characteristics such as the source of the data, the process of acquisition, date of acquisition, etc. However, it is important to recognize that each language sample and the resource from which it is drawn is unique. As a general rule of thumb, a researcher should document the resource as if this were a resource <em>they</em> were to encounter for the first time. To archive this information, it is standard practice to include a <code>README</code> file in the relevant directory where the data is stored.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data/</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived/</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original/</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> cedel2/</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── documentation/</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> └── texts.csv</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> gutenberg/</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── README.md</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── works_pq.csv</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> └── works_pr.csv</span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> lastfm/</span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── README.md</span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── country.csv</span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── hip_hop.csv</span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── lyrics.csv</span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── metal.csv</span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── pop.csv</span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> └── rock.csv</span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> sbc/</span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── meta-data/</span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> └── transcriptions/</span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> scs/</span>
<span id="cb113-23"><a href="#cb113-23" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── README</span>
<span id="cb113-24"><a href="#cb113-24" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── discourse</span>
<span id="cb113-25"><a href="#cb113-25" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── disfluency</span>
<span id="cb113-26"><a href="#cb113-26" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── documentation/</span>
<span id="cb113-27"><a href="#cb113-27" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── tagged</span>
<span id="cb113-28"><a href="#cb113-28" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── timed-transcript</span>
<span id="cb113-29"><a href="#cb113-29" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> └── transcript</span>
<span id="cb113-30"><a href="#cb113-30" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> twitter/</span>
<span id="cb113-31"><a href="#cb113-31" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> README.md</span>
<span id="cb113-32"><a href="#cb113-32" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> rt_latinx.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For both existing corpora and data samples acquired by the researcher it is also important to signal if there are conditions and/ or licensing restrictions that one should heed when using and potentially sharing the data. In some cases existing corpus data come with restrictions on data sharing. These can be quite restrictive and ultimately require that the corpus data not be included in publically available reproducible project or data can only be shared in a derived format. If this the case, it is important to document the steps to legally acquire the data so that a researcher can acquire their own license and take full advantage of your reproducible project.</p>
<p>In the case of data from APIs or web scraping, there too may be stipulations on sharing data. A growing number of data sources apply one of <a href="https://creativecommons.org/about/cclicenses/">the available Creative Common Licenses</a>. Check the source of your data for more information and if you are a member of a research institution you will likely have a <a href="https://zsr.wfu.edu/digital-scholarship/copyright/">specialist</a> on <a href="https://www.copyright.gov/fair-use/more-info.html">Copyright and Fair Use</a>.</p>
</section><section id="summary" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="summary">Summary</h2>
<p>In this chapter we have covered a lot of ground. On the surface we have discussed three methods for acquiring corpus data for use in text analysis. In the process we have delved into various aspects of the R programming language. Some key concepts include writing custom functions and working with those function in an iterative manner. We have also considered topics that are more general in nature and concern interacting with data found on the internet.</p>
<p>Each of these methods should be approached in a way that is transparent to the researcher and to would-be collaborators and the general research community. For this reason the documentation of the steps taken to acquire data are key both in the code and in human-facing documentation.</p>
<p>At this point you have both a bird’s eye view of the data available on the web and strategies on how to access a great majority of it. It is now time to turn to the next step in our data analysis project: data curation. In the next posts I will cover how to wrangle your raw data into a tidy dataset. This will include working with and incorporating meta-data as well as augmenting a dataset with linguistic annotations.</p>
</section><section id="activities" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="activities">Activities</h2>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Recipe
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>What</strong>: <a href="https://lin380.github.io/tadr/articles/recipe_6.html">Control statements, custom functions, and iteration</a><br><strong>How</strong>: Read Recipe 6 and participate in the Hypothes.is online social annotation.<br><strong>Why</strong>: To increase your ability to produce effective, concise, and reproducible code. The three main areas we will cover are working with control statements, writing custom functions, and leveraging iteration. These programming strategies are often useful for acquiring data but, as we will see, they are powerful concepts that can be used throughout a reproducible research project.</p>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Lab
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>What</strong>: <a href="https://github.com/lin380/lab_6">Control statements, custom functions, and iteration</a><br><strong>How</strong>: Clone, fork, and complete the steps in Lab 6.<br><strong>Why</strong>: To gain experience working with coding strategies such as control statements, custom functions, and iteration, practice working with direct downloads and API interfaces to acquire data, and implement organizational strategies for organizing data in reproducible fashion.</p>
</div>
</div>
</section><section id="questions" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="questions">Questions</h2>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Conceptual questions
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>…</li>
<li>…</li>
</ol>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Technical exercises
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>…</li>
<li>…</li>
</ol>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-Adel2020" class="csl-entry" role="doc-biblioentry">
Ädel, Annelie. 2020. <span>“Corpus Compilation.”</span> In <em>A Practical Handbook of Corpus Linguistics</em>, edited by Magali Paquot and Stefan Th. Gries, 3–24. Switzerland: Springer.
</div>
<div id="ref-R-rtweet" class="csl-entry" role="doc-biblioentry">
Kearney, Michael W., Lluís Revilla Sancho, and Hadley Wickham. 2023. <em>Rtweet: Collecting Twitter Data</em>. <a href="https://CRAN.R-project.org/package=rtweet">https://CRAN.R-project.org/package=rtweet</a>.
</div>
<div id="ref-Lozano2009" class="csl-entry" role="doc-biblioentry">
Lozano, Cristóbal. 2009. <span>“CEDEL2: Corpus Escrito Del Español L2.”</span> <em>Applied Linguistics Now: Understanding Language and Mind/La Lingüística Aplicada Hoy: Comprendiendo El Lenguaje y La Mente. Almería: Universidad de Almería</em>, 197–212.
</div>
<div id="ref-R-rvest" class="csl-entry" role="doc-biblioentry">
Wickham, Hadley. 2022. <em>Rvest: Easily Harvest (Scrape) Web Pages</em>. <a href="https://CRAN.R-project.org/package=rvest">https://CRAN.R-project.org/package=rvest</a>.
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>Remember base R packages are installed by default with R and are loaded and accessible by default in each R session.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>See Section @ref(sources) for a list of some other API packages.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p><code>tidyverse</code> is not a typical package. It is a set of packages: <code>ggplot2</code>, <code>dplyr</code>, <code>tidyr</code>, <code>readr</code>, <code>purrr</code>, and <code>tibble</code>. These packages are all installed/ loaded with <code>tidyverse</code> and form the backbone for the type of work you will typically do in most analyses.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>See <a href="https://www.loc.gov/catdir/cpso/lcco/">Library of Congress Classification</a> documentation for a complete list of subject codes.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>It is important to check the paths of sub-domains as some website allow access in some areas and not in others<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p><code>tibble</code> objects are <code>data.frame</code> objects with some added extra bells and whistles that we won’t get into here.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>Note that web links can change and it is often best to safeguard the documentation by downloading the HTML documentation page instead of linking<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./preparation.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Preparation</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./curate-datasets.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Curate data(sets)</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>